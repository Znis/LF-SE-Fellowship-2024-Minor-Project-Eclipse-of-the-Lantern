var V=Object.defineProperty;var G=(s,t,i)=>t in s?V(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i;var r=(s,t,i)=>G(s,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const h of o)if(h.type==="childList")for(const n of h.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function i(o){const h={};return o.integrity&&(h.integrity=o.integrity),o.referrerPolicy&&(h.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?h.credentials="include":o.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function a(o){if(o.ep)return;o.ep=!0;const h=i(o);fetch(o.href,h)}})();var w=(s=>(s.menuScreen="welcomeScreen",s.running="running",s.paused="paused",s.resume="resume",s.retryScreen="retryScreen",s.restart="restart",s))(w||{});const H={0:{enemySpeed:2,enemyMinHealth:1,enemyMaxHealth:3,enemyAttackDamage:1},1:{enemySpeed:3,enemyMinHealth:2,enemyMaxHealth:6,enemyAttackDamage:1.5},2:{enemySpeed:5,enemyMinHealth:4,enemyMaxHealth:10,enemyAttackDamage:2}},T={health_pack:{itemName:"health_pack",images_path:"assets/pickups/health_pack/"},fuel:{itemName:"fuel"},ammo:{itemName:"ammo",count:20}},c={medKit:0,fuel:0,ammo:100,weapons:{axe:{damage:2},gun:{damage:1}}},A={difficultyLevel:0,character:"Ophelia"},e={ctx:{},player:{},bgImage:{},inventory:{},windowWidth:window.innerWidth,windowHeight:window.innerHeight,debugCollider:!1,adjustDeviceColliderX:(window.innerWidth-1536)/2,adjustDeviceColliderY:(window.innerHeight-753)/2,bulletProjectileArray:[],lantern:{},refuelStart:0,isHoldingRefuelKey:!1,healStart:0,isHoldingHealKey:!1,refuelDuration:2e3,healDuration:1e3,enemiesArray:[],animateEnemyArray:[],bloodParticleArray:[],ui:{},rain:!0,reqAnimFrame:0,keyState:{},mainMenu:{},mouseCoords:{x:0,y:0},gameState:"welcomeScreen",pickupItemsArray:[],animatePickupItemsArray:[],cursorImage:{},axe:{},gun:{}};class l{constructor(t,i){r(this,"x");r(this,"y");this.x=t,this.y=i}}class E{constructor(t,i){r(this,"startPoint");r(this,"state");r(this,"blood_img");r(this,"show");this.startPoint=new l(t,i),this.state=0,this.show=!0,this.blood_img=[]}initialiseImages(t,i){const a=()=>{const o=[];for(let h=0;h<=i;h++){const n=new Image;n.src=`${t}/sprite_${h}.png`,o.push(n)}return o};this.blood_img=a();for(let o=0;o<this.blood_img.length-1;o++)setTimeout(()=>{this.state++},90*o)}showAnimation(t=e.ctx){this.show&&t.drawImage(this.blood_img[this.state],this.startPoint.x+e.bgImage.startPoint.x,this.startPoint.y+e.bgImage.startPoint.y);const i=setTimeout(()=>{this.show=!1,clearTimeout(i)},5e3)}}class Q{constructor(){r(this,"id");r(this,"startPoint");r(this,"movement_speed");r(this,"default_speed");r(this,"dirX");r(this,"dirY");r(this,"direction");r(this,"imgSrc");r(this,"images_back");r(this,"images_front");r(this,"images_right");r(this,"images_left");r(this,"health");r(this,"stamina");r(this,"score");r(this,"time");r(this,"frameToShow");r(this,"isBlowingLantern");r(this,"isUsingMedkit");r(this,"frameTime");r(this,"currWeapon");r(this,"isAttacking");this.id="",this.startPoint=new l(0,0),this.movement_speed=4,this.default_speed=this.movement_speed,this.dirX=0,this.dirY=0,this.direction="r",this.imgSrc="",this.images_back=[],this.images_front=[],this.images_left=[],this.images_right=[],this.health=100,this.stamina=100,this.score=0,this.time=0,this.frameToShow=0,this.isBlowingLantern=!1,this.isUsingMedkit=!1,this.frameTime=4,this.currWeapon="axe",this.isAttacking=!1}initialiseImages(t,i){const a=o=>{const h=[];for(let n=1;n<=i;n++){const y=new Image;y.src=`${t}/${o}/${o} (${n}).png`,h.push(y)}return h};this.images_back=a("back"),this.images_front=a("front"),this.images_left=a("left"),this.images_right=a("right")}increaseSpeed(){this.stamina>0?(this.movement_speed=2*this.default_speed,this.drainStamina()):this.movement_speed=this.default_speed}drainStamina(){this.stamina>0?this.stamina-=1:this.stamina=0}change_frames(){this.time>this.frameTime&&(this.frameToShow+=1,this.frameToShow==this.images_back.length&&(this.frameToShow=0),this.time=0),this.time++}show(t=e.ctx){let i=this.images_right[this.frameToShow];this.direction=="r"?i=this.images_right[this.frameToShow]:this.direction=="l"?i=this.images_left[this.frameToShow]:this.direction=="u"?i=this.images_back[this.frameToShow]:this.direction=="d"&&(i=this.images_front[this.frameToShow]),this.health>0&&(t.fillStyle="rgba(20, 20, 20,0.55)",t.beginPath(),t.ellipse(this.startPoint.x+20,this.startPoint.y+70,14,7,0,0,Math.PI*2),t.fill(),t.closePath(),this.direction=="d"&&t.drawImage(i,this.startPoint.x,this.startPoint.y),this.currWeapon=="axe"&&e.axe.show(e.ctx,this.isAttacking),this.currWeapon=="gun"&&e.gun.show(e.ctx,this.isAttacking),this.direction!="d"&&t.drawImage(i,this.startPoint.x,this.startPoint.y))}move(){!this.isBlowingLantern&&!this.isUsingMedkit&&this.health>0&&(this.dirX!=0||this.dirY!=0)&&!e.bgImage.checkCollision(e.bgImage.startPoint.x+this.movement_speed*this.dirX,e.bgImage.startPoint.y+this.movement_speed*this.dirY)&&e.bgImage.startPoint.x+e.adjustDeviceColliderX-e.windowWidth/2<0&&e.bgImage.startPoint.y+e.adjustDeviceColliderY-e.windowHeight/2>-e.bgImage.h&&e.bgImage.startPoint.y+e.adjustDeviceColliderY-e.windowHeight/2<0&&e.bgImage.startPoint.x+e.adjustDeviceColliderX-e.windowWidth/2>-e.bgImage.w&&(e.enemiesArray.forEach(t=>{t.startPoint.x+=this.movement_speed*this.dirX,t.startPoint.y+=this.movement_speed*this.dirY}),e.bgImage.startPoint.x+=this.movement_speed*this.dirX,e.bgImage.startPoint.y+=this.movement_speed*this.dirY,this.change_frames())}increaseHealth(){e.player.health+=20,e.player.health>100&&(e.player.health=100),c.medKit--}}const X={"main-map.jpg":{colliders:[{x:745,y:-440,w:-525,h:-925,color:"green"},{h:-925,w:-2045,x:-830,y:-445,color:"blue"},{x:-1530,y:450,w:-2045,h:-465,color:"red"},{x:-495,y:-695,w:-650,h:-745,color:"blue"},{x:-515,y:-700,w:-670,h:-750,color:"blue"},{x:-690,y:-700,w:-855,h:-750,color:"blue"},{x:-550,y:-720,w:-615,h:-785,color:"blue"},{x:-745,y:-735,w:-810,h:-785,color:"blue"},{x:-505,y:-880,w:-565,h:-925,color:"blue"},{x:-500,y:-860,w:-570,h:-925,color:"blue"},{x:-790,y:-865,w:-865,h:-925,color:"blue"},{x:-315,y:-925,w:-460,h:-990,color:"blue"},{x:-275,y:-985,w:-370,h:-1020,color:"blue"},{x:-265,y:-965,w:-365,h:-1035,color:"blue"},{x:-855,y:-935,w:-935,h:-990,color:"blue"},{x:815,y:-420,w:715,h:-930,color:"blue"},{x:790,y:-930,w:710,h:-1005,color:"blue"},{x:450,y:-1145,w:295,h:-1280,color:"blue"},{x:465,y:-1150,w:295,h:-1275,color:"blue"},{x:640,y:-1140,w:555,h:-1220,color:"blue"},{x:500,y:-1280,w:440,h:-1315,color:"blue"},{x:510,y:-1280,w:450,h:-1345,color:"blue"},{x:515,y:-1265,w:435,h:-1355,color:"blue"},{x:660,y:-1155,w:625,h:-1210,color:"blue"},{x:660,y:-1140,w:630,h:-1225,color:"blue"},{x:150,y:-1170,w:85,h:-1250,color:"blue"},{x:55,y:-1225,w:-40,h:-1300,color:"blue"},{x:615,y:-1475,w:100,h:-1765,color:"blue"},{x:140,y:-1490,w:-45,h:-1720,color:"blue"},{x:655,y:-1520,w:575,h:-1710,color:"blue"},{x:-1025,y:-1305,w:-1145,h:-1385,color:"blue"},{x:-1220,y:-1300,w:-1335,h:-1380,color:"blue"},{x:-1550,y:-975,w:-1915,h:-1240,color:"blue"},{x:-1895,y:-1165,w:-2010,h:-1240,color:"blue"},{x:-1890,y:-940,w:-2095,h:-1080,color:"blue"},{x:-2130,y:-1320,w:-2245,h:-1400,color:"blue"},{x:-1990,y:-1405,w:-2045,h:-1480,color:"blue"},{x:-1420,y:-1705,w:-1475,h:-1765,color:"blue"},{x:-195,y:-1405,w:-295,h:-1485,color:"blue"},{x:-140,y:-1290,w:-240,h:-1370,color:"blue"},{x:160,y:-1170,w:115,h:-1250,color:"blue"},{x:805,y:-1215,w:650,h:-1320,color:"blue"},{x:810,y:-1235,w:655,h:-1355,color:"blue"},{x:805,y:-1225,w:655,h:-1275,color:"blue"},{x:650,y:-1265,w:550,h:-1350,color:"blue"},{x:545,y:-1340,w:460,h:-1405,color:"blue"},{x:-145,y:-1275,w:-255,h:-1340,color:"blue"},{x:-140,y:-1275,w:-250,h:-1310,color:"blue"},{x:-150,y:-1275,w:-250,h:-1305,color:"blue"},{x:535,y:-1320,w:485,h:-1365,color:"blue"},{x:-295,y:-1945,w:-410,h:-1975,color:"blue"},{x:-310,y:-1940,w:-410,h:-2040,color:"blue"},{x:-300,y:-1950,w:-350,h:-1975,color:"blue"},{x:-535,y:-1760,w:-695,h:-1855,color:"blue"},{x:735,y:-1365,w:650,h:-1435,color:"blue"},{x:-265,y:-2320,w:-325,h:-2395,color:"blue"},{x:-500,y:-1800,w:-575,h:-1865,color:"blue"},{x:-520,y:-1755,w:-705,h:-1840,color:"blue"},{x:-525,y:-1760,w:-690,h:-1835,color:"blue"},{x:-1275,y:-1910,w:-1460,h:-1985,color:"blue"},{x:-1330,y:-1965,w:-1410,h:-2025,color:"blue"},{x:-1305,y:-1950,w:-1345,h:-2e3,color:"blue"},{x:-1290,y:-1900,w:-1465,h:-1935,color:"blue"},{x:-1380,y:-1950,w:-1445,h:-2010,color:"blue"},{x:-670,y:-2045,w:-1550,h:-2090,color:"blue"},{x:-655,y:-2040,w:-1560,h:-2110,color:"blue"},{x:-2330,y:-1345,w:-2385,h:-1410,color:"blue"},{x:-2740,y:-1060,w:-3020,h:-1130,color:"blue"},{x:-2330,y:-1345,w:-2390,h:-1410,color:"blue"},{x:-2735,y:-1060,w:-3020,h:-1140,color:"blue"},{x:-2465,y:-670,w:-2585,h:-750,color:"blue"},{x:-2650,y:-410,w:-3070,h:-660,color:"blue"},{x:-2515,y:-420,w:-2685,h:-520,color:"blue"},{x:-2595,y:-485,w:-2690,h:-580,color:"blue"},{x:-3050,y:-570,w:-3115,h:-660,color:"blue"},{x:-3050,y:-415,w:-3155,h:-505,color:"blue"},{x:-1505,y:-2050,w:-1560,h:-2430,color:"blue"},{x:-1415,y:-2375,w:-1565,h:-2425,color:"blue"},{x:-1420,y:-2370,w:-1565,h:-2445,color:"blue"},{x:-805,y:-2085,w:-1380,h:-2345,color:"blue"},{x:-780,y:-2060,w:-830,h:-2335,color:"blue"},{x:-650,y:-2055,w:-700,h:-2375,color:"blue"},{x:-660,y:-2325,w:-775,h:-2395,color:"blue"},{x:-1315,y:-2310,w:-1385,h:-2360,color:"blue"},{x:80,y:460,w:-1200,h:315,color:"blue"},{x:-545,y:345,w:-810,h:265,color:"blue"},{x:-490,y:335,w:-560,h:280,color:"blue"},{x:-520,y:305,w:-565,h:285,color:"blue"},{x:-515,y:295,w:-560,h:285,color:"blue"},{x:-525,y:320,w:-570,h:275,color:"blue"},{x:200,y:460,w:45,h:415,color:"blue"},{x:175,y:460,w:55,h:400,color:"blue"},{x:165,y:430,w:45,h:360,color:"blue"},{x:140,y:400,w:60,h:345,color:"blue"},{x:125,y:380,w:65,h:340,color:"blue"},{x:115,y:375,w:45,h:305,color:"blue"},{x:-795,y:340,w:-855,h:280,color:"blue"},{x:-1190,y:470,w:-1315,h:405,color:"blue"},{x:-1190,y:435,w:-1230,h:350,color:"blue"},{x:-1230,y:440,w:-1270,h:395,color:"blue"},{x:-1215,y:445,w:-1265,h:375,color:"blue"},{x:-1180,y:395,w:-1225,h:345,color:"blue"},{x:-1225,y:395,w:-1260,h:380,color:"blue"},{x:-1715,y:-1940,w:-2640,h:-2030,color:"blue"},{x:-2040,y:-1920,w:-2400,h:-1980,color:"blue"},{x:-2580,y:-1965,w:-2650,h:-2400,color:"blue"},{x:-410,y:-2025,w:-605,h:-2095,color:"blue"},{x:-435,y:-2070,w:-585,h:-2150,color:"blue"},{x:-525,y:-2085,w:-680,h:-2195,color:"blue"},{x:-2025,y:-85,w:-2230,h:-190,color:"blue"},{x:-2065,y:-50,w:-2230,h:-100,color:"blue"},{x:-2415,y:450,w:-2680,h:340,color:"blue"},{x:-2555,y:410,w:-2650,h:325,color:"blue"},{x:-2610,y:355,w:-2680,h:245,color:"blue"},{x:-1697,y:-1962.5,w:-1757,h:-2432.5,color:"blue"},{x:-1702,y:-1967.5,w:-1767,h:-2432.5,color:"blue"},{x:-1707,y:-1952.5,w:-1762,h:-2447.5,color:"blue"},{x:-1762,y:-2102.5,w:-1897,h:-2217.5,color:"blue"},{x:-1762,y:-2087.5,w:-1897,h:-2222.5,color:"blue"},{x:-1917,y:-1992.5,w:-2092,h:-2107.5,color:"blue"},{x:-2062,y:-1942.5,w:-2197,h:-2167.5,color:"blue"},{x:-2082,y:-1982.5,w:-2392,h:-2072.5,color:"blue"},{x:-2042,y:-1997.5,w:-2077,h:-2172.5,color:"blue"},{x:-2227,y:-2017.5,w:-2387,h:-2162.5,color:"blue"},{x:-2437,y:-1992.5,w:-2612,h:-2102.5,color:"blue"},{x:-1747,y:-2367.5,w:-2252,h:-2442.5,color:"blue"},{x:-1762,y:-2302.5,w:-1862,h:-2367.5,color:"blue"},{x:-1747,y:-2292.5,w:-1852,h:-2377.5,color:"blue"},{x:-2467,y:-2372.5,w:-2782,h:-2432.5,color:"blue"},{x:-2632,y:-2337.5,w:-2797,h:-2397.5,color:"blue"},{x:-2657,y:-2467.5,w:-2732,h:-2542.5,color:"blue"},{x:-2187,y:-2452.5,w:-2237,h:-2527.5,color:"blue"},{x:-2457,y:-2477.5,w:-2542,h:-2572.5,color:"blue"},{x:-1082,y:-2457.5,w:-1142,h:-2532.5,color:"blue"},{x:-567,y:-2272.5,w:-627,h:-2337.5,color:"blue"},{x:-557,y:-2277.5,w:-657,h:-2352.5,color:"blue"},{x:-2672,y:-1267.5,w:-2852,h:-1352.5,color:"blue"},{x:-2957,y:-1252.5,w:-3142,h:-1332.5,color:"blue"},{x:-2992,y:-1332.5,w:-3112,h:-1367.5,color:"blue"},{x:-2992,y:-1302.5,w:-3102,h:-1372.5,color:"blue"},{x:-2857,y:-1307.5,w:-2957,h:-1362.5,color:"blue"},{x:-2857,y:-1307.5,w:-2962,h:-1377.5,color:"blue"},{x:-3322,y:-1847.5,w:-3842,h:-2152.5,color:"blue"},{x:-3322,y:-1847.5,w:-3697,h:-2157.5,color:"blue"},{x:-3262,y:-2017.5,w:-3362,h:-2097.5,color:"blue"},{x:-3227,y:-2057.5,w:-3302,h:-2122.5,color:"blue"},{x:-3262,y:-2002.5,w:-3342,h:-2042.5,color:"blue"},{x:-3662,y:-1892.5,w:-3842,h:-2147.5,color:"blue"},{x:778,y:-2212.5,w:628,h:-2337.5,color:"blue"},{x:783,y:-2217.5,w:598,h:-2327.5,color:"blue"},{x:798,y:-2342.5,w:533,h:-2522.5,color:"blue"},{x:708,y:-2282.5,w:603,h:-2427.5,color:"blue"},{x:808,y:-2397.5,w:518,h:-2522.5,color:"blue"},{x:803,y:-2402.5,w:538,h:-2512.5,color:"blue"},{x:803,y:-2562.5,w:358,h:-2632.5,color:"blue"},{x:408,y:-2577.5,w:353,h:-3027.5,color:"blue"},{x:468,y:-2947.5,w:358,h:-3027.5,color:"blue"},{x:403,y:-2997.5,w:358,h:-3052.5,color:"blue"},{x:783,y:-2582.5,w:623,h:-2872.5,color:"blue"},{x:793,y:-2607.5,w:443,h:-2767.5,color:"blue"},{x:613,y:-2637.5,w:448,h:-2877.5,color:"blue"},{x:683,y:-2732.5,w:563,h:-2797.5,color:"blue"},{x:673,y:-2722.5,w:563,h:-2822.5,color:"blue"},{x:658,y:-2782.5,w:573,h:-2847.5,color:"blue"},{x:-3657,y:-2347.5,w:-4052,h:-2657.5,color:"blue"},{x:-3762,y:-2612.5,w:-4047,h:-2722.5,color:"blue"},{x:-3752,y:-2632.5,w:-3787,h:-2717.5,color:"blue"},{x:-3617,y:-2522.5,w:-3682,h:-2612.5,color:"blue"},{x:-3147,y:-2707.5,w:-3207,h:-2782.5,color:"blue"},{x:-3122,y:-2882.5,w:-4047,h:-2972.5,color:"blue"},{x:-3137,y:-2937.5,w:-3317,h:-3082.5,color:"blue"},{x:-3127,y:-2907.5,w:-3327,h:-3087.5,color:"blue"},{x:-492,y:-3262.5,w:-677,h:-3342.5,color:"blue"},{x:-3332,y:-2992.5,w:-3502,h:-3242.5,color:"blue"},{x:-3342,y:-3197.5,w:-3502,h:-3267.5,color:"blue"},{x:-3512,y:-2977.5,w:-3682,h:-3257.5,color:"blue"},{x:-3422,y:-2987.5,w:-3532,h:-3222.5,color:"blue"},{x:-3432,y:-3162.5,w:-3587,h:-3207.5,color:"blue"},{x:-3442,y:-3162.5,w:-3542,h:-3222.5,color:"blue"},{x:-3447,y:-3177.5,w:-3552,h:-3222.5,color:"blue"},{x:-3437,y:-3182.5,w:-3557,h:-3242.5,color:"blue"},{x:-3687,y:-3082.5,w:-3932,h:-3317.5,color:"blue"},{x:-3087,y:-1697.5,w:-3167,h:-1797.5,color:"blue"},{x:-3217,y:-1707.5,w:-3327,h:-1797.5,color:"blue"},{x:123,y:-2467.5,w:53,h:-2542.5,color:"blue"},{x:528,y:-2127.5,w:438,h:-2187.5,color:"blue"},{x:528,y:-2112.5,w:433,h:-2192.5,color:"blue"},{x:-3092,y:-3267.5,w:-3162,h:-3352.5,color:"blue"},{x:-2172,y:-2952.5,w:-2642,h:-3352.5,color:"blue"},{x:-2022,y:-3012.5,w:-2202,h:-3187.5,color:"blue"},{x:-2132,y:-3197.5,w:-2197,h:-3337.5,color:"blue"},{x:-2222,y:-3317.5,w:-2352,h:-3392.5,color:"blue"},{x:-2327,y:-3317.5,w:-2427,h:-3502.5,color:"blue"},{x:-2317,y:-3332.5,w:-2637,h:-3497.5,color:"blue"},{x:-2607,y:-3042.5,w:-2717,h:-3312.5,color:"blue"},{x:-2592,y:-3052.5,w:-2692,h:-3282.5,color:"blue"},{x:-2607,y:-3237.5,w:-2667,h:-3292.5,color:"blue"},{x:-2662,y:-3157.5,w:-2742,h:-3217.5,color:"blue"},{x:-2667,y:-3067.5,w:-2717,h:-3122.5,color:"blue"},{x:-1167,y:-3267.5,w:-1342,h:-3342.5,color:"blue"},{x:-2612,y:-3497.5,w:-2677,h:-3537.5,color:"blue"},{x:-2602,y:-3487.5,w:-2682,h:-3542.5,color:"blue"},{x:-2707,y:-3482.5,w:-2772,h:-3537.5,color:"blue"},{x:-2797,y:-3477.5,w:-2877,h:-3532.5,color:"blue"},{x:-297,y:-3012.5,w:-497,h:-3087.5,color:"blue"},{x:-267,y:-3187.5,w:-457,h:-3262.5,color:"blue"},{x:-252,y:-3242.5,w:-337,h:-3327.5,color:"blue"},{x:-697,y:-3102.5,w:-797,h:-3192.5,color:"blue"},{x:-457,y:-3447.5,w:-552,h:-3527.5,color:"blue"},{x:-637,y:-3582.5,w:-747,h:-3662.5,color:"blue"},{x:-1602,y:-3442.5,w:-1707,h:-3527.5,color:"blue"},{x:-1587,y:-2957.5,w:-1777,h:-3047.5,color:"blue"},{x:-1177,y:-3012.5,w:-1372,h:-3092.5,color:"blue"},{x:-977,y:-3207.5,w:-1177,h:-3287.5,color:"blue"},{x:803,y:-3119.5,w:333,h:-3664.5,color:"blue"},{x:273,y:-3144.5,w:193,h:-3244.5,color:"blue"},{x:263,y:-3469.5,w:208,h:-3529.5,color:"blue"},{x:-1037,y:-3449.5,w:-1137,h:-3529.5,color:"blue"},{x:-1582,y:-3104.5,w:-1682,h:-3174.5,color:"blue"},{x:-2087,y:-2759.5,w:-2157,h:-2829.5,color:"blue"},{x:-542,y:-2759.5,w:-612,h:-2844.5,color:"blue"},{x:-3577,y:-1344.5,w:-3652,h:-1414.5,color:"blue"},{x:-3577,y:-1339.5,w:-3637,h:-1414.5,color:"blue"},{x:-3617,y:-1234.5,w:-3877,h:-1319.5,color:"blue"},{x:-2642,y:475.5,w:-3007,h:175.5,color:"blue"},{x:-2642,y:470.5,w:-4042,h:250.5,color:"blue"},{x:-2982,y:310.5,w:-4037,h:195.5,color:"blue"},{x:-3657,y:225.5,w:-4037,h:-289.5,color:"blue"},{x:-3612,y:-254.5,w:-3787,h:-364.5,color:"blue"},{x:-3717,y:-334.5,w:-3782,h:-399.5,color:"blue"},{x:-692,y:-3109.5,w:-797,h:-3179.5,color:"blue"},{x:-3857,y:-594.5,w:-3937,h:-734.5,color:"blue"},{x:-3857,y:-904.5,w:-3937,h:-1049.5,color:"blue"},{x:803,y:-254.5,w:408,h:-379.5,color:"blue"}],events:{doors:[{h:-2128,w:-2247,x:-2172,y:-2053,map:"house.png",other_pos:0,next_cor:{x:510-(1920-e.windowWidth)/2,y:-180-(922-e.windowHeight)/2}}]},depth:{path:'assets/maps/"main-map-depth.jpg"'},enemiesCount:10,size:"native",weather:!0,position:"native",type:"hostile"},"house.png":{colliders:[{x:723,y:260.5,w:633,h:-344.5,color:"blue"},{x:688,y:265.5,w:233,h:130.5,color:"blue"},{x:708,y:255.5,w:233,h:105.5,color:"blue"},{x:578,y:165.5,w:233,h:30.5,color:"blue"},{x:583,y:190.5,w:233,h:35.5,color:"blue"},{x:308,y:380.5,w:43,h:220.5,color:"blue"},{x:93,y:340.5,w:8,h:-369.5,color:"blue"},{x:688,y:-89.5,w:503,h:-224.5,color:"blue"},{x:493,y:-99.5,w:328,h:-209.5,color:"blue"},{x:438,y:-179.5,w:368,h:-249.5,color:"blue"},{x:443,y:-179.5,w:328,h:-239.5,color:"blue"},{x:428,y:-214.5,w:338,h:-254.5,color:"blue"},{x:688,y:-314.5,w:338,h:-354.5,color:"blue"},{x:398,y:-214.5,w:333,h:-399.5,color:"blue"},{x:403,y:-229.5,w:328,h:-399.5,color:"blue"},{x:173,y:210.5,w:103,h:140.5,color:"blue"},{x:223,y:140.5,w:148,h:85.5,color:"blue"},{x:213,y:120.5,w:143,h:-34.5,color:"blue"},{x:218,y:90.5,w:108,h:-24.5,color:"blue"},{x:223,y:85.5,w:98,h:-34.5,color:"blue"},{x:268,y:20.5,w:193,h:-54.5,color:"blue"},{x:268,y:20.5,w:188,h:-44.5,color:"blue"},{x:118,y:60.5,w:58,h:.5,color:"blue"},{x:223,y:125.5,w:138,h:75.5,color:"blue"},{x:158,y:100.5,w:93,h:70.5,color:"blue"},{x:243,y:25.5,w:188,h:-14.5,color:"blue"},{x:313,y:-99.5,w:248,h:-334.5,color:"blue"},{x:298,y:-94.5,w:148,h:-219.5,color:"blue"},{x:138,y:-94.5,w:38,h:-219.5,color:"blue"},{x:173,y:-89.5,w:143,h:-164.5,color:"blue"},{x:178,y:-99.5,w:143,h:-199.5,color:"blue"},{x:128,y:-244.5,w:43,h:-309.5,color:"blue"},{x:133,y:-239.5,w:43,h:-299.5,color:"blue"},{x:133,y:-239.5,w:43,h:-314.5,color:"blue"},{x:258,y:-279.5,w:78,h:-309.5,color:"blue"},{x:268,y:-169.5,w:238,h:-309.5,color:"blue"},{x:263,y:-299.5,w:83,h:-309.5,color:"blue"},{x:268,y:-164.5,w:233,h:-354.5,color:"blue"}],events:{doors:[{x:355.5,y:-279.5,w:280.5,h:-339.5,map:"main-map.jpg",other_pos:1,next_cor:{x:-2020-(1920-e.windowWidth)/2,y:-2053-(922-e.windowHeight)/2}}]},enemiesCount:0,depth:{path:'assets/maps/"house-depth.png"'},size:{width:850,height:850},weather:!1,type:"calm"}};class Z{constructor(t){r(this,"startPoint");r(this,"w");r(this,"h");r(this,"img");r(this,"depthImg");r(this,"name");r(this,"mapData");r(this,"otherMaps");r(this,"otherMapsDepth");this.startPoint=new l(-2220+e.adjustDeviceColliderX,-2220+e.adjustDeviceColliderY),this.w=4800,this.h=4080,this.name=t,this.img=new Image,this.img.src="./assets/maps/"+this.name,this.otherMaps=[this.img],this.depthImg=new Image,this.depthImg.src="./assets/maps/"+this.getDepthImgName(),this.mapData=X;let i=new Image;i.src="assets/maps/house.png",this.otherMaps=[i],i=new Image,i.src="assets/maps/house-depth.png",this.otherMapsDepth=[i],this.otherMaps.push(this.img),this.otherMapsDepth.push(this.depthImg)}getDepthImgName(){let t=this.name.split("."),i;return t.splice(1,0,"-depth."),i=t.join(""),i}show(t=e.ctx){if(t.clearRect(0,0,e.windowWidth,e.windowHeight),t.fillStyle="#181425",t.fillRect(0,0,e.windowWidth,e.windowHeight),this.checkEvents(),this.w==0&&this.h==0&&this.mapData[this.name].size=="native")t.drawImage(this.img,this.startPoint.x,this.startPoint.y);else{const i=this.mapData[this.name].size;i=="native"?t.drawImage(this.img,this.startPoint.x,this.startPoint.y):t.drawImage(this.img,this.startPoint.x,this.startPoint.y,i.width,i.height)}}showDepth(t=e.ctx){this.w==0&&this.h==0&&this.mapData[this.name].size=="native"?t.drawImage(this.depthImg,this.startPoint.x,this.startPoint.y):t.drawImage(this.depthImg,this.startPoint.x,this.startPoint.y,this.mapData[this.name].size.width,this.mapData[this.name].size.height)}checkEvents(t=this.startPoint.x,i=this.startPoint.y){this.mapData[this.name].events.doors.map(a=>{t-e.adjustDeviceColliderX<a.x&&t-e.adjustDeviceColliderX>a.w&&i-e.adjustDeviceColliderY<a.y&&i-e.adjustDeviceColliderY>a.h&&(this.startPoint.x=a.next_cor.x,this.startPoint.y=a.next_cor.y,this.name=a.map,this.img=this.otherMaps[a.other_pos],this.depthImg=this.otherMapsDepth[a.other_pos])})}checkCollision(t,i){let a=!1,o=this.mapData[this.name].colliders.length;for(let h=0;h<o;h++){let n=this.mapData[this.name].colliders[h];if(!e.debugCollider&&t-e.adjustDeviceColliderX<n.x&&t-e.adjustDeviceColliderX>n.w&&i-e.adjustDeviceColliderY<n.y&&i-e.adjustDeviceColliderY>n.h){a=!0;break}}return a}}class ee{constructor(){r(this,"x");r(this,"y");r(this,"maxRadiusInnerCircle");r(this,"maxRadiusOuterCircle");r(this,"decreaseLuminosity");this.decreaseLuminosity=null,this.x=e.player.startPoint.x+20,this.y=e.player.startPoint.y+50,this.maxRadiusInnerCircle=250,this.maxRadiusOuterCircle=Math.max(e.windowWidth,e.windowHeight)/2}showLuminosity(){const t=e.ctx.createRadialGradient(this.x,this.y,this.maxRadiusInnerCircle,this.x,this.y,this.maxRadiusOuterCircle);t.addColorStop(0,"rgba(0, 0, 0, 0)"),t.addColorStop(.1,"rgba(0, 0, 0, 0.8)"),t.addColorStop(.2,"rgba(0, 0, 0, 0.9)"),t.addColorStop(1,"rgba(0, 0, 0, 1)"),e.ctx.fillStyle=t,e.ctx.fillRect(0,0,m.width,m.height)}changeLuminosity(){this.decreaseLuminosity||(this.decreaseLuminosity=setInterval(()=>{this.maxRadiusInnerCircle<=0?(this.maxRadiusInnerCircle=0,clearInterval(this.decreaseLuminosity)):this.maxRadiusInnerCircle-=1},200))}resetLuminosity(){const t=setInterval(()=>{this.maxRadiusInnerCircle>=250?(this.maxRadiusInnerCircle=250,clearInterval(t)):this.maxRadiusInnerCircle+=5},10)}}function te(s,t){return s+Math.floor((t-s)*Math.random())}function M(s,t){const i=t.x-s.x,a=t.y-s.y;return Math.sqrt(i**2+a**2)}function W(s,t){const i=s.x-t.x,a=s.y-t.y;return Math.atan2(a,i)}class ie{constructor(t,i){r(this,"startPoint");r(this,"images_back");r(this,"images_front");r(this,"images_left");r(this,"images_right");r(this,"MAX_HEALTH");r(this,"MIN_HEALTH");r(this,"damage");r(this,"health");r(this,"movement_speed");r(this,"finalX");r(this,"finalY");r(this,"direction");r(this,"frameToShow");r(this,"time");r(this,"h");r(this,"w");r(this,"r");r(this,"default_movement_speed");r(this,"default_damage");r(this,"default_health");r(this,"damageTimeout");this.startPoint=new l(t,i),this.direction="d",this.h=te(80,100),this.w=this.h,this.r=40,this.MAX_HEALTH=5,this.MIN_HEALTH=2,this.default_damage=1,this.damage=this.default_damage,this.images_back=[],this.images_front=[],this.images_left=[],this.images_right=[],this.frameToShow=0,this.time=0,this.damageTimeout=null,this.default_health=Math.random()*(this.MAX_HEALTH-this.MIN_HEALTH)+this.MIN_HEALTH,this.health=this.default_health,this.default_movement_speed=1,this.movement_speed=Math.random()+this.default_movement_speed,this.finalX=e.player.startPoint.x+Math.floor((2*Math.random()-1)*50)-40,this.finalY=e.player.startPoint.y+Math.floor((2*Math.random()-1)*50)-40}initialiseGolblinImages(t,i){const a=o=>{const h=[];for(let n=1;n<=i;n++){const y=new Image;y.src=`${t}/${o}/${o} (${n}).png`,h.push(y)}return h};this.images_back=a("back"),this.images_front=a("front"),this.images_left=a("left"),this.images_right=a("right")}change_frames(){this.time>4&&(this.frameToShow+=1,this.frameToShow==this.images_back.length&&(this.frameToShow=0),this.time=0),this.time++}updateAttributes(){M(this.startPoint,e.player.startPoint)>e.lantern.maxRadiusInnerCircle*2?(this.movement_speed=this.default_movement_speed*2,this.damage=this.default_damage*2,this.health=this.default_health*2):(this.movement_speed=this.default_movement_speed,this.damage=this.default_damage)}determineDirection(){const t=W(new l(this.finalX,this.finalY),this.startPoint)*(180/Math.PI);t>=-45&&t<45?this.direction="r":t>=45&&t<135?this.direction="d":t>=-135&&t<-45?this.direction="u":this.direction="l"}show(t=e.ctx){let i=this.images_right[this.frameToShow];this.direction=="r"?i=this.images_right[this.frameToShow]:this.direction=="l"?i=this.images_left[this.frameToShow]:this.direction=="u"?i=this.images_back[this.frameToShow]:this.direction=="d"&&(i=this.images_front[this.frameToShow]),t.fillStyle="rgba(20, 20, 20, 0.6)",t.beginPath();const a=this.w/3,o=this.h/10;t.ellipse(this.startPoint.x+this.w/2,this.startPoint.y+this.h-10,a,o,0,0,2*Math.PI),t.fill(),this.startPoint.x>-100&&this.startPoint.x<e.windowWidth&&this.startPoint.y>-100&&this.startPoint.y<e.windowHeight&&t.drawImage(i,this.startPoint.x,this.startPoint.y,this.w,this.h)}move(){if(M(e.player.startPoint,this.startPoint)<1e3){let t=this.finalX-this.startPoint.x,i=this.finalY-this.startPoint.y,a=M(new l(this.finalX,this.finalY),this.startPoint);if(a>this.movement_speed){let o=this.movement_speed/a,h=o*t,n=o*i;e.bgImage.checkCollision(e.bgImage.startPoint.x-this.startPoint.x+this.finalX,e.bgImage.startPoint.y-this.startPoint.y+this.finalY+this.movement_speed)?this.startPoint.x=h+this.startPoint.x:e.bgImage.checkCollision(e.bgImage.startPoint.x-this.startPoint.x+this.finalX+this.movement_speed,e.bgImage.startPoint.y-this.startPoint.y+this.finalY)?this.startPoint.y=n+this.startPoint.y:(this.startPoint.x=h+this.startPoint.x,this.startPoint.y=n+this.startPoint.y)}else this.startPoint.x=this.finalX,this.startPoint.y=this.finalY;this.startPoint.x==this.finalX&&this.startPoint.y==this.finalY&&(e.player.health>0?this.damageTimeout||(this.damageTimeout=setTimeout(()=>{e.player.health-=this.damage,this.damageTimeout=null},500)):clearTimeout(this.damageTimeout))}this.change_frames()}}class j{constructor(t,i=5){r(this,"no_of_frames");r(this,"frameIndex");r(this,"time");r(this,"has_more_than_one_state");r(this,"animation_speed");r(this,"frames_array");this.has_more_than_one_state=!1,this.animation_speed=i,this.frames_array=t,typeof t=="object"&&(this.has_more_than_one_state=!0),this.no_of_frames=t.length,this.frameIndex=0,this.time=0}change_frames(){let t=this.animation_speed;this.time>t&&(this.frameIndex+=1,this.frameIndex==this.frames_array.length&&(this.frameIndex=0),this.time=0),this.time++}frame(){return this.frameIndex}}class F{constructor(){r(this,"slope");r(this,"startPoint");r(this,"c");this.slope=1,this.startPoint=new l(Math.floor(Math.random()*1920),Math.random()*1e3),this.c=this.startPoint.y-this.startPoint.x*this.slope}show(t=e.ctx){let i=Math.random()*100;t.strokeStyle="rgb(200, 200, 200)",t.beginPath(),t.moveTo(this.startPoint.x,this.startPoint.y),t.lineTo(this.generateX(this.startPoint.y+i),this.startPoint.y+i),t.stroke()}move(){this.startPoint.y=this.startPoint.y+Math.random()*30,this.startPoint.x=this.generateX(this.startPoint.y)}generateX(t){return(t-this.c)/this.slope}}class se{constructor(){r(this,"healthImages");r(this,"overlayImages");r(this,"staminaImage");r(this,"healthBars");r(this,"staminaBars");r(this,"rainParticles");this.healthImages=[],this.staminaImage={},this.overlayImages=[],this.healthBars=5,this.staminaBars=5,this.rainParticles=[]}initialiseImages(t){const i=a=>{const o=new Image;return o.src=a,o};this.healthImages[0]=i(`${t}/border.png`),this.healthImages[1]=i(`${t}/health.png`),this.staminaImage=i(`${t}/stamina.png`),this.healthImages[2]=i(`${t}/empty.png`),this.overlayImages[0]=i(`${t}/bloodOverlay.png`)}renderBloodOverlay(t=e.ctx){t.drawImage(this.overlayImages[0],0,0,e.windowWidth,e.windowHeight)}renderScore(t=e.ctx){t.font="40px Outfit",t.textAlign="right",t.fillStyle="white";const i=e.windowWidth-100;t.fillText(`Score: ${e.player.score}`,i,40)}renderHealth(t=e.ctx){(e.player.health<30||e.lantern.maxRadiusInnerCircle<80)&&this.renderBloodOverlay();let i=0;for(let a=0;a<this.healthBars;a++)t.drawImage(this.healthImages[0],(a+1)*30+10,10,30,30),e.player.health>i?t.drawImage(this.healthImages[1],(a+1)*30+10,10,30,30):t.drawImage(this.healthImages[2],(a+1)*30+10,10,30,30),i+=100/this.healthBars}renderStamina(t=e.ctx){let i=0;for(let a=0;a<this.staminaBars;a++)t.drawImage(this.healthImages[0],200+(a+1)*30+10,10,30,30),e.player.stamina>i?t.drawImage(this.staminaImage,200+(a+1)*30+10,10,30,30):t.drawImage(this.healthImages[2],200+(a+1)*30+10,10,30,30),i+=100/this.staminaBars;e.player.stamina<100&&(e.player.stamina+=.1)}initialiseRainParticles(){for(let t=0;t<200;t++)this.rainParticles[t]=new F}renderRainParticles(){let t=0;this.rainParticles.forEach(i=>{i.show(),i.move(),i.startPoint.y>1920&&(this.rainParticles[t]=new F),t+=1})}}function oe(){const s=new FontFace("Nos","url(assets/font/Nos.ttf)");document.fonts.add(s);const t=new FontFace("stat","url(assets/font/stat.ttf)");document.fonts.add(t)}class re{constructor(){r(this,"startPoint");r(this,"hoveredOption");r(this,"hoveredChar");r(this,"difficultyLevel");r(this,"selectedChar");r(this,"difficulties");r(this,"menuItems");r(this,"charItems");r(this,"charInfo");r(this,"characterImages");this.startPoint=new l(e.windowWidth/15,150),this.hoveredOption=-1,this.hoveredChar=-1,this.difficultyLevel=0,this.selectedChar=0,this.difficulties=["GENOCIDE","HOMICIDE","SUICIDE"],this.menuItems=[{text:"Eclipse of the Lantern",fontSize:e.windowWidth/25,x:this.startPoint.x,y:this.startPoint.y+e.windowWidth/15*0,type:1},{text:e.gameState==w.retryScreen?"RETRY":"START JOURNEY",fontSize:e.windowWidth/25,x:this.startPoint.x,y:this.startPoint.y+e.windowWidth/20*2,type:0},{text:"DIFFICULTY: ",fontSize:e.windowWidth/20,x:this.startPoint.x,y:this.startPoint.y+e.windowWidth/20*3,type:0}],this.charItems=[{text:"SELECT CHARACTER",x:e.windowWidth/1.5+100,y:300},{text:"<",x:e.windowWidth/1.5,y:500},{text:">",x:e.windowWidth/1.5+400,y:500}],this.characterImages=[],this.charInfo=[{name:"Ophelia",desc:"Detective"},{name:"Noah",desc:"Detective"}],e.windowWidth<1330&&e.windowHeight>600?(this.charItems[0].x=this.startPoint.x,this.charItems[0].y=350,this.charItems[1].x=this.startPoint.x,this.charItems[1].y=400,this.charItems[2].x=this.startPoint.x+100,this.charItems[2].y=400):e.windowWidth<1550&&e.windowHeight<600&&(this.charItems[0].x=500,this.charItems[0].y=200,this.charItems[1].x=550,this.charItems[1].y=250,this.charItems[2].x=680,this.charItems[2].y=250)}initialiseImages(){this.charInfo.forEach(t=>{const i=new Image;i.src=`assets/character/images/$Characters/profile/${t.name}.png`,this.characterImages.push(i)})}show(t=e.ctx){t.fillStyle="rgba(0, 0, 0, 0.74)",t.fillRect(0,0,e.windowWidth,e.windowHeight),t.textAlign="left",t.font="30px Nos";let i=0,a=!0,o=e.mouseCoords.x,h=e.mouseCoords.y;this.menuItems.forEach(n=>{t.font=`${n.fontSize}px Nos`,t.fillStyle="rgb(255, 255, 255)";let y=!1;o>=n.x&&o<n.x+n.text.length/1.5*n.fontSize&&h<=n.y&&h>n.y-n.fontSize&&(y=!0,this.hoveredOption=i,a=!1),n.type==1||y?i>0&&(t.font="30px stat",t.fillStyle="red"):(t.font="30px stat",t.fillStyle="rgb(255, 255, 255)"),i==2?t.fillText(n.text+this.difficulties[this.difficultyLevel],n.x,n.y):t.fillText(n.text,n.x,n.y),i++}),a&&(this.hoveredOption=-1),a=!0,i=0,this.charItems.forEach(n=>{t.fillStyle="rgb(255, 255, 255)",o>=n.x&&o<n.x+50&&h<=n.y&&h>n.y-50&&(t.fillStyle="red",a=!1,this.hoveredChar=i),t.fillText(n.text,n.x,n.y),i++}),a&&(this.hoveredChar=-1),e.windowWidth<1330&&e.windowHeight>600?(t.drawImage(this.characterImages[this.selectedChar],this.startPoint.x+30,370,50,50),t.font="20px stat",t.textAlign="center",t.fillStyle="rgb(255, 255, 255)",t.fillText(this.charInfo[this.selectedChar].name,this.startPoint.x,450,100)):e.windowWidth<1550&&e.windowHeight<600?(t.drawImage(this.characterImages[this.selectedChar],600,210,50,50),t.font="20px stat",t.textAlign="center",t.fillStyle="rgb(255, 255, 255)",t.fillText(this.charInfo[this.selectedChar].name,575,280,100)):(t.drawImage(this.characterImages[this.selectedChar],e.windowWidth/1.5+140,500,100,100),t.font="40px stat",t.textAlign="center",t.fillStyle="rgb(255, 255, 255)",t.fillText(this.charInfo[this.selectedChar].name,e.windowWidth/1.5+200,450,500),t.font="20px stat")}handleSelect(){(this.hoveredChar==1||this.hoveredChar==2)&&(this.selectedChar=this.selectedChar==0?1:0),this.hoveredOption==2&&(this.difficultyLevel<this.difficulties.length-1?this.difficultyLevel++:this.difficultyLevel=0),this.hoveredOption==1&&(A.difficultyLevel=this.difficultyLevel,A.character=this.charInfo[this.selectedChar].name,Se())}}const ae="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/pickups/fuel/fuel.png",Y=new Image;Y.src=ae;const C={sprite:Y,width:24,height:25,position:[new l(0,0),new l(24,0),new l(48,0),new l(72,0),new l(96,0),new l(120,0),new l(144,0),new l(168,0)]};class le{constructor(t,i,a){r(this,"images");r(this,"startPoint");r(this,"isUsed");r(this,"type");r(this,"frameCount");r(this,"spritePos");this.images=[],this.startPoint=new l(t,i),this.isUsed=!1,this.type=a,this.frameCount=11,this.spritePos=0}initialiseImages(){for(let t=1;t<=this.frameCount;t++){const i=new Image;i.src=`${this.type.images_path}${this.type.itemName} (${t}).png`,this.images[t-1]=i}}show(t,i,a=e.ctx){const o=e.bgImage.startPoint.x+this.startPoint.x,h=e.bgImage.startPoint.y+this.startPoint.y;let n=o+16,y=h+40,S=i+10,_=i+5;if(this.type.itemName=="fuel"){let D=Math.floor(this.spritePos/5)%8;a.drawImage(C.sprite,C.position[D].x,C.position[D].y,C.width,C.height,o,h,30,30),this.spritePos++}else if(this.type.itemName=="health_pack")n=o+30,y=h+50,S=i+14,_=i+4,a.drawImage(t,o,h,60,60);else if(this.type.itemName=="ammo"){S=i+22;const L=new Image;L.src="/assets/inventory/ammo.png",a.drawImage(L,o,h,30,30)}a.fillStyle="rgba(20, 20, 20, 150)",a.beginPath(),a.ellipse(n,y,S/2,_/2,0,0,Math.PI*2),a.fill()}collect(){Math.sqrt(Math.abs(Math.pow(-(e.bgImage.startPoint.x-e.player.startPoint.x)-this.startPoint.x,2)+Math.pow(-(e.bgImage.startPoint.y-e.player.startPoint.y)-this.startPoint.y,2)))<50&&(this.type.itemName=="health_pack"?c.medKit++:this.type.itemName=="fuel"?c.fuel++:this.type.itemName=="ammo"&&(c.ammo+=50),this.isUsed=!0)}}class he{constructor(){r(this,"fuelImg");r(this,"medKitImg");r(this,"ammoImg");this.fuelImg={},this.medKitImg={},this.ammoImg={}}initialiseImages(){const t=i=>{const a=new Image;return a.src=i,a};this.fuelImg=t("/assets/inventory/fuel.png"),this.medKitImg=t("/assets/inventory/medkit.png"),this.ammoImg=t("/assets/inventory/ammo.png")}show(t=e.ctx){t.textAlign="center",t.fillStyle="white",t.font="16px Outfit",t.drawImage(this.medKitImg,30,80,40,40),t.fillText(`x ${c.medKit}`,100,105,100),t.drawImage(this.fuelImg,30,140,40,40),t.fillText(`x ${c.fuel}`,100,170,100),t.drawImage(this.ammoImg,30,200,40,40),t.fillText(`x ${c.ammo}`,100,225,100)}displayMessage(t=e.ctx,i){t.textAlign="center",t.fillStyle="white",t.font="24px Outfit",i=="health_pack"&&t.fillText("Out of Med Kit!",m.width/2,m.height-50,400),i=="fuel"&&t.fillText("Out of Fuel!",m.width/2,m.height-50,400),i=="ammo"&&t.fillText("Out of Ammo!",m.width/2,m.height-50,400)}}const ne="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/weapons/axe-left/axe-left.png",ce="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/weapons/axe-right/axe-right.png",ye="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/weapons/axe-back/back.png",me="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/weapons/axe-front/front.png",O=new Image;O.src=ne;const $=new Image;$.src=ce;const K=new Image;K.src=ye;const B=new Image;B.src=me;const f={sprite:O,height:54,position:[new l(0,0),new l(77,0),new l(141,0),new l(228,0),new l(312,0),new l(392,0),new l(487,0),new l(564,0)],offset:[{x:12,y:10},{x:0,y:10},{x:-24,y:18},{x:-24,y:32},{x:-28,y:44},{x:-26,y:32},{x:-24,y:18},{x:12,y:10}],width:[32,30,49,51,38,49,30,32]},g={sprite:$,height:54,position:[new l(0,0),new l(77,0),new l(155,0),new l(245,0),new l(317,0),new l(411,0),new l(487,0),new l(564,0)],offset:[{x:-25,y:10},{x:10,y:10},{x:20,y:28},{x:20,y:44},{x:20,y:28},{x:20,y:20},{x:-12,y:10},{x:-24,y:10}],width:[32,30,49,51,50,60,30,32]},p={sprite:B,height:50,position:[new l(0,0),new l(26,0),new l(37,0)],offset:[{x:28,y:8},{x:28,y:8},{x:28,y:8}],width:[9,9,9]},x={sprite:K,height:50,position:[new l(1,0),new l(34,0),new l(47,0)],offset:[{x:30,y:10},{x:30,y:10},{x:30,y:10}],width:[8,8,8]};class ue{constructor(){r(this,"startPoint");r(this,"r");r(this,"spritePos");r(this,"shockPoint");this.startPoint=e.player.startPoint,this.r=50,this.spritePos=0,this.shockPoint=new l(0,0)}show(t=e.ctx,i){if(e.player.direction=="r"){let o=i?Math.floor(this.spritePos/5)%8:0;t.drawImage(g.sprite,g.position[o].x,g.position[o].y,g.width[o],g.height,e.player.startPoint.x+g.offset[o].x,e.player.startPoint.y+g.offset[o].y,50,50),i&&(this.spritePos++,this.spritePos%40==0&&(e.player.isAttacking=!1))}else if(e.player.direction=="l"){let o=i?Math.floor(this.spritePos/5)%8:0;t.drawImage(f.sprite,f.position[o].x,f.position[o].y,f.width[o],f.height,e.player.startPoint.x+f.offset[o].x,e.player.startPoint.y+f.offset[o].y,50,50),i&&(this.spritePos++,this.spritePos%40==0&&(e.player.isAttacking=!1))}else if(e.player.direction=="u"){let o=i?Math.floor(this.spritePos/14)%3:0;t.drawImage(x.sprite,x.position[o].x,x.position[o].y,x.width[o],x.height,e.player.startPoint.x+x.offset[o].x,e.player.startPoint.y+x.offset[o].y,8,50),i&&(this.spritePos++,this.spritePos%42==0&&(e.player.isAttacking=!1))}else if(e.player.direction=="d"){let o=i?Math.floor(this.spritePos/14)%3:0;t.drawImage(p.sprite,p.position[o].x,p.position[o].y,p.width[o],p.height,e.player.startPoint.x+p.offset[o].x,e.player.startPoint.y+p.offset[o].y,8,50),i&&(this.spritePos++,this.spritePos%42==0&&(e.player.isAttacking=!1))}t.fillStyle="rgba(20, 20, 20,0.55)",t.beginPath(),t.ellipse(this.shockPoint.x,this.shockPoint.y,10,10,0,0,Math.PI*2),t.fill(),t.closePath()}calculateShockPoint(){const t=Math.atan2(e.mouseCoords.y-e.player.startPoint.y,e.mouseCoords.x-e.player.startPoint.x),i=Math.sin(t)*this.r,a=Math.cos(t)*this.r;this.shockPoint=new l(this.startPoint.x+a+20,this.startPoint.y+i+50)}hits(t){return M(new l(this.shockPoint.x,this.shockPoint.y),new l(t.startPoint.x+t.w/2,t.startPoint.y+t.h/2))<this.r}}const de="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/weapons/gun-left/gun-left.png",we="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/weapons/gun-right/gun-right.png",fe="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/weapons/gun-back/gun-back.png",ge="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/weapons/gun-front/gun-front.png",N=new Image;N.src=de;const U=new Image;U.src=we;const z=new Image;z.src=fe;const q=new Image;q.src=ge;const u={sprite:N,height:65,position:[new l(0,0),new l(136,0),new l(274,0),new l(408,0)],offset:[{x:-8,y:24},{x:-8,y:20},{x:-8,y:22},{x:-8,y:24}],width:[116,116,110,116]},d={sprite:U,height:65,position:[new l(0,0),new l(137,0),new l(270,0),new l(408,0)],offset:[{x:-4,y:24},{x:-4,y:20},{x:-4,y:22},{x:-4,y:24}],width:[116,110,116,116]},b={sprite:q,height:28,position:[new l(3,0),new l(50,0),new l(99,0),new l(144,0)],offset:[{x:32,y:14},{x:32,y:14},{x:32,y:14},{x:32,y:14}],width:[19,20,18,19]},P={sprite:z,height:28,position:[new l(1,0),new l(41,0),new l(88,0),new l(127,0)],offset:[{x:32,y:10},{x:32,y:10},{x:32,y:10},{x:32,y:10}],width:[22,26,20,20]};class pe{constructor(t,i,a,o=!1){r(this,"startPoint");r(this,"initialX");r(this,"initialY");r(this,"r");r(this,"endPoint");r(this,"movement_speed");r(this,"mouse");r(this,"dir");r(this,"toDelete");this.startPoint=new l(t.x-30,t.y+30),this.mouse=o,this.dir=i,this.initialX=this.startPoint.x,this.initialY=this.startPoint.y,this.r=5,this.endPoint=a,this.movement_speed=20,this.toDelete=!1}show(t=e.ctx){t.strokeStyle="none",t.fillStyle="rgb(255, 255, 100)",I(t,this.startPoint.x,this.startPoint.y,this.r*1.5,this.r*1.5),t.fillStyle="rgba(255, 170, 51, 0.016)";for(let i=0;i<this.r*4;i++)I(t,this.initialX-10,this.initialY,i*3,i*3);t.save(),t.translate(this.startPoint.x,this.startPoint.y),t.rotate(Math.atan2(this.startPoint.y-this.endPoint.y,this.startPoint.x-this.endPoint.x));for(let i=0;i<this.r*4;i++)I(t,0,0,i*5,i);t.restore()}hits(t){return M(new l(this.startPoint.x-100,this.startPoint.y-130),new l(t.startPoint.x-50,t.startPoint.y-50))<this.r+t.r}evaporate(){this.toDelete=!0}move(){if(this.mouse||(this.dir=="u"&&(this.startPoint.y=this.startPoint.y-this.movement_speed),this.dir=="d"&&(this.startPoint.y=this.startPoint.y+this.movement_speed),this.dir=="r"&&(this.startPoint.x=this.startPoint.x+this.movement_speed),this.dir=="l"&&(this.startPoint.x=this.startPoint.x-this.movement_speed)),this.mouse){let t=this.endPoint.x-this.startPoint.x,i=this.endPoint.y-this.startPoint.y,a=M(this.endPoint,this.startPoint);if(a>this.movement_speed){let o=this.movement_speed/a,h=o*t,n=o*i;this.startPoint.x=h+this.startPoint.x,this.startPoint.y=n+this.startPoint.y}else this.startPoint.x=this.endPoint.x,this.startPoint.y=this.endPoint.y,this.evaporate()}}}class xe{constructor(){r(this,"startPoint");r(this,"spritePos");this.startPoint=e.player.startPoint,this.spritePos=0}show(t=e.ctx,i){if(e.player.direction=="r"){let o=i?Math.floor(this.spritePos/5)%4:0;if(t.drawImage(d.sprite,d.position[o].x,d.position[o].y,d.width[o],d.height,e.player.startPoint.x+d.offset[o].x,e.player.startPoint.y+d.offset[o].y,50,50),i){t.fillStyle="rgba(255, 170, 51, 0.04)";for(let h=0;h<14;h++)I(t,e.player.startPoint.x+d.offset[o].x+50,e.player.startPoint.y+d.offset[o].y+20,h*3,h*3);this.spritePos++,this.spritePos%20==0&&(e.player.isAttacking=!1)}}else if(e.player.direction=="l"){let o=i?Math.floor(this.spritePos/5)%4:0;if(t.drawImage(u.sprite,u.position[o].x,u.position[o].y,u.width[o],u.height,e.player.startPoint.x+u.offset[o].x,e.player.startPoint.y+u.offset[o].y,50,50),i){t.fillStyle="rgba(255, 170, 51, 0.04)";for(let h=0;h<14;h++)I(t,e.player.startPoint.x+u.offset[o].x,e.player.startPoint.y+u.offset[o].y+20,h*3,h*3);this.spritePos++,this.spritePos%20==0&&(e.player.isAttacking=!1)}}else if(e.player.direction=="u"){let o=i?Math.floor(this.spritePos/5)%4:0;if(t.drawImage(P.sprite,P.position[o].x,P.position[o].y,P.width[o],P.height,e.player.startPoint.x+P.offset[o].x,e.player.startPoint.y+P.offset[o].y,8,50),i){t.fillStyle="rgba(255, 170, 51, 0.04)";for(let h=0;h<14;h++)I(t,e.player.startPoint.x+u.offset[o].x+45,e.player.startPoint.y+u.offset[o].y,h*3,h*3);this.spritePos++,this.spritePos%20==0&&(e.player.isAttacking=!1)}}else if(e.player.direction=="d"){let o=i?Math.floor(this.spritePos/5)%4:0;if(t.drawImage(b.sprite,b.position[o].x,b.position[o].y,b.width[o],b.height,e.player.startPoint.x+b.offset[o].x,e.player.startPoint.y+b.offset[o].y,8,50),i){t.fillStyle="rgba(255, 170, 51, 0.04)";for(let h=0;h<14;h++)I(t,e.player.startPoint.x+u.offset[o].x+45,e.player.startPoint.y+u.offset[o].y+10,h*3,h*3);this.spritePos++,this.spritePos%20==0&&(e.player.isAttacking=!1)}}}fire(){const t=W(new l(e.mouseCoords.x,e.mouseCoords.y),e.player.startPoint)*(180/Math.PI);t>=-45&&t<45?e.player.direction="r":t>=45&&t<135?e.player.direction="d":t>=-135&&t<-45?e.player.direction="u":e.player.direction="l";const i=new pe(new l(e.player.startPoint.x+60,e.player.startPoint.y+20),e.player.direction,new l(e.mouseCoords.x,e.mouseCoords.y),!0);e.bulletProjectileArray.push(i),c.ammo--}}function be(){e.player=new Q,e.ui=new se,e.cursorImage=new Image,e.cursorImage.src="assets/axe.png",e.inventory=new he,e.axe=new ue,e.gun=new xe,e.inventory.initialiseImages(),e.ui.initialiseImages("./assets/ui"),e.ui.initialiseRainParticles(),e.player.initialiseImages("assets/character/images/",4),e.player.direction="r",e.player.startPoint.x=e.windowWidth/2,e.player.startPoint.y=e.windowHeight/2,e.lantern=new ee,e.bgImage=new Z("main-map.jpg"),e.mainMenu=new re,e.mainMenu.initialiseImages(),oe()}function Pe(){m.width=window.innerWidth,m.height=window.innerHeight}function Ie(){(e.player.health<=0||e.lantern.maxRadiusInnerCircle<=0)&&(e.gameState=w.retryScreen)}function Se(){Ae(),e.gameState=w.running,Ee(150),ve(150),e.enemiesArray.forEach(s=>{s.MAX_HEALTH=H[A.difficultyLevel].enemyMaxHealth,s.MIN_HEALTH=H[A.difficultyLevel].enemyMinHealth,s.default_damage=H[A.difficultyLevel].enemyAttackDamage,s.default_movement_speed=H[A.difficultyLevel].enemySpeed})}function _e(){e.player.currWeapon=="gun"?e.cursorImage.src="/assets/crosshair.png":e.cursorImage.src="/assets/axe.png",e.ctx.drawImage(e.cursorImage,e.mouseCoords.x,e.mouseCoords.y,40,40)}function ve(s){for(;s!=0;){const t=Math.random()<.3?Math.random()<.5?T.ammo:T.health_pack:T.fuel;let i=Math.random()*e.bgImage.w,a=Math.random()*e.bgImage.h;if(!e.bgImage.checkCollision(i,a)){const o=new le(i,a,t);o.initialiseImages(),e.pickupItemsArray.push(o);const h=new j(o.images,12);e.animatePickupItemsArray.push(h),s--}}}function ke(){for(let s=0;s<e.pickupItemsArray.length;s++)e.pickupItemsArray[s].show(e.pickupItemsArray[s].images[e.animatePickupItemsArray[s].frame()],e.animatePickupItemsArray[s].frame()),e.animatePickupItemsArray[s].change_frames(),e.pickupItemsArray[s].collect(),e.pickupItemsArray[s].isUsed&&(e.pickupItemsArray.splice(s,1),e.animatePickupItemsArray.splice(s,1))}function Ae(){e.player.health=100,e.player.score=0,e.lantern.maxRadiusInnerCircle=250,e.bgImage.startPoint=new l(-2220+e.adjustDeviceColliderX,-2220+e.adjustDeviceColliderY),e.bloodParticleArray=[],e.bulletProjectileArray=[],e.enemiesArray=[],e.pickupItemsArray=[],e.keyState={},e.animateEnemyArray=[],e.animatePickupItemsArray=[],c.medKit=0,c.fuel=0,c.ammo=20}function Me(){e.inventory.show()}function Ce(){e.ui.renderHealth(),e.ui.renderStamina(),e.ui.renderScore()}function He(){e.mainMenu.show()}function Le(){e.enemiesArray.forEach(s=>{s.show(),s.move(),s.determineDirection(),s.updateAttributes()})}function Te(s){const t=m.getBoundingClientRect(),i=s.clientX-t.left,a=s.clientY-t.top;return{x:i,y:a}}function De(){e.bulletProjectileArray.forEach(s=>{s.show(),s.move()}),e.bulletProjectileArray=e.bulletProjectileArray.filter(s=>!s.toDelete)}function R(){let s=0,t="";e.isHoldingRefuelKey?(s=e.refuelDuration,t=" Refueling Lantern"):e.isHoldingHealKey&&(s=e.healDuration,t=" Using Med Kit");const i=new Date().getTime();let a=0;e.isHoldingHealKey&&(a=i-e.healStart),e.isHoldingRefuelKey&&(a=i-e.refuelStart);const o=s-a;o<0&&(e.isHoldingHealKey=!1,e.isHoldingRefuelKey=!1);const h=1-Math.min(a/s,1),n=400,y=20,S=(e.windowWidth-n)/2,_=e.windowHeight-50;e.ctx.fillStyle="#ccc",e.ctx.fillRect(S,_,n,y),e.ctx.fillStyle="#76c7c0",e.ctx.fillRect(S,_,n*h,y),e.ctx.font="16px Outfit",e.ctx.fillStyle="#fff",e.ctx.textAlign="center",e.ctx.fillText(`${t} ${(o/1e3).toFixed(1)}s`,e.windowWidth/2,_-10)}function Ee(s){for(;s!=0;){let t=Math.random()*e.bgImage.w,i=Math.random()*e.bgImage.h;if(!e.bgImage.checkCollision(t,i)){let a=new ie(t,i);a.initialiseGolblinImages("assets/enemy/goblin",6);let o=new j(a.images_front,2);e.enemiesArray.push(a),e.animateEnemyArray.push(o),s--}}}function I(s,t,i,a,o){s.beginPath(),s.ellipse(t,i,a/2,o/2,0,0,Math.PI*2),s.fill(),s.closePath()}function Fe(){if(e.player.currWeapon=="gun")e.bulletProjectileArray.forEach(s=>{for(let t=0;t<e.enemiesArray.length;t++)if(s.hits(e.enemiesArray[t])){e.enemiesArray[t].health-=1,s.evaporate();const i=new E(e.enemiesArray[t].startPoint.x-e.bgImage.startPoint.x,e.enemiesArray[t].startPoint.y-e.bgImage.startPoint.y);i.initialiseImages("assets/blood",7),e.bloodParticleArray.push(i),e.enemiesArray[t].health<1&&(e.player.score++,e.enemiesArray.splice(t,1),e.animateEnemyArray.splice(t,1))}});else if(e.player.currWeapon=="axe"&&e.player.isAttacking){for(let s=0;s<e.enemiesArray.length;s++)if(e.axe.hits(e.enemiesArray[s])){e.enemiesArray[s].health-=.1;const t=new E(e.enemiesArray[s].startPoint.x-e.bgImage.startPoint.x,e.enemiesArray[s].startPoint.y-e.bgImage.startPoint.y);t.initialiseImages("assets/blood",7),e.bloodParticleArray.push(t),e.enemiesArray[s].health<1&&(e.player.score++,e.enemiesArray.splice(s,1),e.animateEnemyArray.splice(s,1))}}for(let s=e.bloodParticleArray.length-1;s>=0;s--)e.bloodParticleArray[s].showAnimation(),e.bloodParticleArray[s].show||e.bloodParticleArray.splice(s,1);for(let s=e.bulletProjectileArray.length-1;s>=0;s--)e.bulletProjectileArray[s].toDelete&&e.bulletProjectileArray.splice(s,1)}window.addEventListener("keydown",function(s){e.keyState[s.keyCode||s.which]=!0},!0);window.addEventListener("keyup",function(s){e.keyState[s.keyCode||s.which]=!1},!0);window.addEventListener("mousemove",function(s){e.mouseCoords=Te(s)},!0);window.addEventListener("click",function(){e.gameState!=w.running&&e.mainMenu.handleSelect()},!0);window.addEventListener("click",()=>{e.gameState==w.running&&!e.player.isBlowingLantern&&e.player.health>0&&(e.player.currWeapon=="gun"?c.ammo>0?(e.player.isAttacking=!0,e.gun.fire()):e.inventory.displayMessage(e.ctx,"ammo"):e.player.currWeapon=="axe"&&(e.player.isAttacking=!0,e.axe.calculateShockPoint()))});let v=null,k=null;function Re(){e.keyState[87]&&e.keyState[68]?(e.player.direction="u",e.player.dirX=-.72,e.player.dirY=.72,e.player.move()):e.keyState[87]&&e.keyState[65]?(e.player.direction="u",e.player.dirX=.72,e.player.dirY=.72,e.player.move()):e.keyState[83]&&e.keyState[65]?(e.player.direction="d",e.player.dirX=.72,e.player.dirY=-.72,e.player.move()):e.keyState[83]&&e.keyState[68]?(e.player.direction="d",e.player.dirX=-.72,e.player.dirY=-.72,e.player.move()):e.keyState[65]?(e.player.direction="l",e.player.dirX=1,e.player.dirY=0,e.player.move()):e.keyState[68]?(e.player.direction="r",e.player.dirX=-1,e.player.dirY=0,e.player.move()):e.keyState[83]?(e.player.direction="d",e.player.dirX=0,e.player.dirY=-1,e.player.move()):e.keyState[87]?(e.player.direction="u",e.player.dirX=0,e.player.dirY=1,e.player.move()):(e.player.frameToShow=0,e.player.dirX=0,e.player.dirY=0),e.keyState[76]&&(e.debugCollider=!e.debugCollider),e.keyState[16]?(e.player.frameTime=2,e.player.increaseSpeed()):(e.player.movement_speed=e.player.default_speed,e.player.frameTime=4),e.keyState[81]&&(e.player.currWeapon=e.player.currWeapon=="axe"?"gun":"axe"),e.keyState[32]?!k&&e.player.health>0&&(c.medKit>0?(e.healStart=new Date().getTime(),e.isHoldingHealKey=!0,e.player.isUsingMedkit=!0,k=setTimeout(()=>{e.player.increaseHealth(),k=null,e.player.isUsingMedkit=!1,e.isHoldingHealKey=!1,e.healStart=null},e.healDuration)):e.inventory.displayMessage(e.ctx,"health_pack")):k&&e.player.health>0&&(clearTimeout(k),k=null,e.isHoldingHealKey=!1,e.player.isUsingMedkit=!1,e.healStart=null),e.keyState[70]?!v&&e.player.health>0&&(c.fuel>0?(e.refuelStart=new Date().getTime(),e.isHoldingRefuelKey=!0,e.player.isBlowingLantern=!0,v=setTimeout(()=>{e.lantern.resetLuminosity(),c.fuel--,v=null,e.player.isBlowingLantern=!1,e.isHoldingRefuelKey=!1,e.refuelStart=null},e.refuelDuration)):e.inventory.displayMessage(e.ctx,"fuel")):v&&e.player.health>0&&(clearTimeout(v),v=null,e.isHoldingRefuelKey=!1,e.player.isBlowingLantern=!1,e.refuelStart=null)}const m=document.querySelector("#gameCanvas");e.ctx=m.getContext("2d");m.width=e.windowWidth;m.height=e.windowHeight;be();function J(){Pe(),e.bgImage.show(),e.gameState==w.running&&(e.ui.renderRainParticles(),ke(),Re(),Le(),Fe(),e.player.show(),e.lantern.showLuminosity(),e.lantern.changeLuminosity(),De(),Ce(),Me(),e.bgImage.showDepth(),console.log(e.animateEnemyArray.length,e.animatePickupItemsArray.length),e.axe.calculateShockPoint(),e.isHoldingRefuelKey&&e.refuelStart!=null&&R(),e.isHoldingHealKey&&e.healStart!=null&&R(),Ie()),(e.gameState==w.menuScreen||e.gameState==w.retryScreen)&&(e.lantern.showLuminosity(),e.ui.renderBloodOverlay(),e.lantern.maxRadiusInnerCircle=10,He()),_e(),e.debugCollider&&X[e.bgImage.name].colliders.forEach(s=>{e.ctx.fillStyle=s.color||"#ffffff",e.ctx.beginPath(),e.ctx.fillRect(20+(e.windowWidth/2+e.bgImage.startPoint.x-(s.x+e.adjustDeviceColliderX)),50+(e.windowHeight/2+e.bgImage.startPoint.y-(s.y+e.adjustDeviceColliderY)),Math.abs(s.x-s.w),Math.abs(s.y-s.h))}),e.reqAnimFrame=requestAnimationFrame(J)}e.reqAnimFrame=requestAnimationFrame(J);
