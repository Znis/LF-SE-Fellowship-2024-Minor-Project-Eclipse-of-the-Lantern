var Tt=Object.defineProperty;var Mt=(o,e,i)=>e in o?Tt(o,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[e]=i;var a=(o,e,i)=>Mt(o,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function i(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(r){if(r.ep)return;r.ep=!0;const l=i(r);fetch(r.href,l)}})();const I={Q:!1,F:!1,SPACE:!1};var c=(o=>(o.menuScreen="welcomeScreen",o.running="running",o.paused="paused",o.resume="resume",o.retryScreen="retryScreen",o.restart="restart",o.gameFinish="gameFinish",o))(c||{});const O={0:{enemySpeed:2,enemyMinHealth:1,enemyMaxHealth:3,enemyAttackDamage:1},1:{enemySpeed:3,enemyMinHealth:2,enemyMaxHealth:6,enemyAttackDamage:1.5},2:{enemySpeed:5,enemyMinHealth:4,enemyMaxHealth:10,enemyAttackDamage:2}},U={health_pack:{itemName:"health_pack",images_path:"assets/pickups/health_pack/"},fuel:{itemName:"fuel"},ammo:{itemName:"ammo",count:20}},d={medKit:0,fuel:0,ammo:100,weapons:{axe:{damage:2},gun:{damage:1}}},b={difficultyLevel:0,character:"Ophelia"},t={ctx:{},player:{},bgImage:{},inventory:{},windowWidth:window.innerWidth,windowHeight:window.innerHeight,debugCollider:!1,adjustDeviceColliderX:(window.innerWidth-1536)/2,adjustDeviceColliderY:(window.innerHeight-753)/2,bulletProjectileArray:[],fireProjectileArray:[],lantern:{},refuelStart:0,isHoldingRefuelKey:!1,healStart:0,isHoldingHealKey:!1,refuelDuration:2e3,healDuration:1e3,enemiesArray:[],animateEnemyArray:[],bloodParticleArray:[],ui:{},rain:!0,reqAnimFrame:0,keyState:{},mainMenu:{},mouseCoords:{x:0,y:0},gameState:"welcomeScreen",pickupItemsArray:[],animatePickupItemsArray:[],cursorImage:{},axe:{},gun:{},boss:{},flameImages:[]};class s{constructor(e,i){a(this,"x");a(this,"y");this.x=e,this.y=i}}class B{constructor(e,i){a(this,"startPoint");a(this,"state");a(this,"blood_img");a(this,"show");this.startPoint=new s(e,i),this.state=0,this.show=!0,this.blood_img=[]}initialiseImages(e,i){const n=()=>{const r=[];for(let l=0;l<=i;l++){const h=new Image;h.src=`${e}/sprite_${l}.png`,r.push(h)}return r};this.blood_img=n();for(let r=0;r<this.blood_img.length-1;r++)setTimeout(()=>{this.state++},90*r)}showAnimation(e=t.ctx){this.show&&e.drawImage(this.blood_img[this.state],this.startPoint.x+t.bgImage.startPoint.x,this.startPoint.y+t.bgImage.startPoint.y);const i=setTimeout(()=>{this.show=!1,clearTimeout(i)},5e3)}}function P(o,e){return o+Math.floor((e-o)*Math.random())}function f(o,e){const i=e.x-o.x,n=e.y-o.y;return Math.sqrt(i**2+n**2)}function z(o,e){const i=o.x-e.x,n=o.y-e.y;return Math.atan2(n,i)}class V{constructor(e,i,n,r){a(this,"startPoint");a(this,"initialX");a(this,"initialY");a(this,"r");a(this,"endPoint");a(this,"movement_speed");a(this,"dir");a(this,"toDelete");a(this,"images");a(this,"spritePos");a(this,"owner");this.startPoint=new s(e.x-30,e.y+30),this.dir=i,this.initialX=this.startPoint.x,this.initialY=this.startPoint.y,this.r=5,this.endPoint=new s(n.x*1.05,n.y*1.05),this.movement_speed=10,this.toDelete=!1,this.images=[],this.spritePos=0,this.initialiseImages(),this.owner=r}initialiseImages(){this.images=t.flameImages}show(e=t.ctx){let n=Math.floor(this.spritePos/5)%30;e.save(),e.translate(this.startPoint.x,this.startPoint.y),e.rotate(Math.atan2(this.endPoint.y-this.startPoint.y,this.endPoint.x-this.startPoint.x)),e.drawImage(this.images[n],-100,-100,200,200),e.restore(),this.spritePos++}hits(e){return f(new s(this.startPoint.x-100,this.startPoint.y-130),new s(e.startPoint.x-50,e.startPoint.y-50))<this.r+e.r}evaporate(){this.toDelete=!0}move(){let e=this.endPoint.x-this.startPoint.x,i=this.endPoint.y-this.startPoint.y,n=f(this.endPoint,this.startPoint);if(n>this.movement_speed){let r=this.movement_speed/n,l=r*e,h=r*i;this.startPoint.x=l+this.startPoint.x,this.startPoint.y=h+this.startPoint.y}else this.startPoint.x=this.endPoint.x,this.startPoint.y=this.endPoint.y,this.evaporate()}}class Dt{constructor(){a(this,"id");a(this,"startPoint");a(this,"movement_speed");a(this,"default_speed");a(this,"dirX");a(this,"dirY");a(this,"direction");a(this,"imgSrc");a(this,"images_back");a(this,"images_front");a(this,"images_right");a(this,"images_left");a(this,"health");a(this,"stamina");a(this,"score");a(this,"time");a(this,"frameToShow");a(this,"isBlowingLantern");a(this,"isUsingMedkit");a(this,"frameTime");a(this,"currWeapon");a(this,"isAttacking");a(this,"isWalking");a(this,"isRunning");a(this,"abilityMode");a(this,"r");this.id="",this.startPoint=new s(0,0),this.movement_speed=4,this.default_speed=this.movement_speed,this.dirX=0,this.dirY=0,this.direction="r",this.imgSrc="",this.images_back=[],this.images_front=[],this.images_left=[],this.images_right=[],this.health=100,this.stamina=100,this.score=0,this.time=0,this.frameToShow=0,this.isBlowingLantern=!1,this.isUsingMedkit=!1,this.frameTime=4,this.currWeapon="axe",this.isAttacking=!1,this.isWalking=!1,this.isRunning=!1,this.abilityMode=!1,this.r=50}initialiseImages(e,i){const n=r=>{const l=[];for(let h=1;h<=i;h++){const y=new Image;y.src=`${e}/${r}/${r} (${h}).png`,l.push(y)}return l};this.images_back=n("back"),this.images_front=n("front"),this.images_left=n("left"),this.images_right=n("right")}increaseSpeed(){this.stamina>0?(this.movement_speed=2*this.default_speed,this.isRunning=!0,this.drainStamina()):(this.movement_speed=this.default_speed,this.isRunning=!1)}drainStamina(){this.stamina>0?this.stamina-=1:this.stamina=0}change_frames(){this.time>this.frameTime&&(this.frameToShow+=1,this.frameToShow==this.images_back.length&&(this.frameToShow=0),this.time=0),this.time++}show(e=t.ctx){let i=this.images_right[this.frameToShow];this.direction=="r"?i=this.images_right[this.frameToShow]:this.direction=="l"?i=this.images_left[this.frameToShow]:this.direction=="u"?i=this.images_back[this.frameToShow]:this.direction=="d"&&(i=this.images_front[this.frameToShow]),this.health>0&&(e.fillStyle="rgba(20, 20, 20,0.55)",e.beginPath(),e.ellipse(this.startPoint.x+20,this.startPoint.y+70,14,7,0,0,Math.PI*2),e.fill(),e.closePath(),this.direction=="d"&&e.drawImage(i,this.startPoint.x,this.startPoint.y),this.direction=="u"&&t.lantern.show(),this.currWeapon=="axe"&&t.axe.show(t.ctx,this.isAttacking),this.currWeapon=="gun"&&t.gun.show(t.ctx,this.isAttacking),this.direction!="d"&&e.drawImage(i,this.startPoint.x,this.startPoint.y),this.direction!="u"&&t.lantern.show())}move(){!this.isBlowingLantern&&!this.isUsingMedkit&&this.health>0&&(this.dirX!=0||this.dirY!=0)&&(t.bgImage.checkCollision(t.bgImage.startPoint.x+this.movement_speed*this.dirX,t.bgImage.startPoint.y+this.movement_speed*this.dirY)||(t.bgImage.startPoint.x+t.adjustDeviceColliderX-t.windowWidth/2<0||this.dirX>0&&(this.dirX=0),t.bgImage.startPoint.y+t.adjustDeviceColliderY-t.windowHeight/2>-t.bgImage.h||this.dirY<0&&(this.dirY=0),t.bgImage.startPoint.y+t.adjustDeviceColliderY-t.windowHeight/2<0||this.dirY>0&&(this.dirY=0),t.bgImage.startPoint.x+t.adjustDeviceColliderX-t.windowWidth/2>-t.bgImage.w||this.dirX<0&&(this.dirX=0),t.enemiesArray.forEach(e=>{e.startPoint.x+=this.movement_speed*this.dirX,e.startPoint.y+=this.movement_speed*this.dirY}),t.pickupItemsArray.forEach(e=>{e.startPoint.x+=this.movement_speed*this.dirX,e.startPoint.y+=this.movement_speed*this.dirY}),t.boss.startPoint.x+=this.movement_speed*this.dirX,t.boss.startPoint.y+=this.movement_speed*this.dirY,t.bgImage.startPoint.x+=this.movement_speed*this.dirX,t.bgImage.startPoint.y+=this.movement_speed*this.dirY,this.isWalking=!0,this.change_frames()))}increaseHealth(){t.player.health+=20,t.player.health>100&&(t.player.health=100),d.medKit--}useAbility(e){if(e=="light")if(t.inventory.abilities[0].cooldown==0){t.lantern.setLuminosity(),t.inventory.resetAbility(e);const i=setTimeout(()=>{t.lantern.resetLuminosity(),clearTimeout(i)},5e3)}else t.inventory.displayMessage(t.ctx,"","Ability on Cooldown!");else if(e=="flame"&&t.inventory.abilities[1].cooldown==0){t.inventory.resetAbility(e);const i=new V(new s(t.player.startPoint.x+60,t.player.startPoint.y+20),t.player.direction,new s(t.mouseCoords.x,t.mouseCoords.y),"player");t.fireProjectileArray.push(i)}}}const Z={"main-map.jpg":{colliders:[{x:745,y:-440,w:-525,h:-925,color:"green"},{h:-925,w:-2045,x:-830,y:-445,color:"blue"},{x:-1530,y:450,w:-2045,h:-465,color:"red"},{x:-495,y:-695,w:-650,h:-745,color:"blue"},{x:-515,y:-700,w:-670,h:-750,color:"blue"},{x:-690,y:-700,w:-855,h:-750,color:"blue"},{x:-550,y:-720,w:-615,h:-785,color:"blue"},{x:-745,y:-735,w:-810,h:-785,color:"blue"},{x:-505,y:-880,w:-565,h:-925,color:"blue"},{x:-500,y:-860,w:-570,h:-925,color:"blue"},{x:-790,y:-865,w:-865,h:-925,color:"blue"},{x:-315,y:-925,w:-460,h:-990,color:"blue"},{x:-275,y:-985,w:-370,h:-1020,color:"blue"},{x:-265,y:-965,w:-365,h:-1035,color:"blue"},{x:-855,y:-935,w:-935,h:-990,color:"blue"},{x:815,y:-420,w:715,h:-930,color:"blue"},{x:790,y:-930,w:710,h:-1005,color:"blue"},{x:450,y:-1145,w:295,h:-1280,color:"blue"},{x:465,y:-1150,w:295,h:-1275,color:"blue"},{x:640,y:-1140,w:555,h:-1220,color:"blue"},{x:500,y:-1280,w:440,h:-1315,color:"blue"},{x:510,y:-1280,w:450,h:-1345,color:"blue"},{x:515,y:-1265,w:435,h:-1355,color:"blue"},{x:660,y:-1155,w:625,h:-1210,color:"blue"},{x:660,y:-1140,w:630,h:-1225,color:"blue"},{x:150,y:-1170,w:85,h:-1250,color:"blue"},{x:55,y:-1225,w:-40,h:-1300,color:"blue"},{x:615,y:-1475,w:100,h:-1765,color:"blue"},{x:140,y:-1490,w:-45,h:-1720,color:"blue"},{x:655,y:-1520,w:575,h:-1710,color:"blue"},{x:-1025,y:-1305,w:-1145,h:-1385,color:"blue"},{x:-1220,y:-1300,w:-1335,h:-1380,color:"blue"},{x:-1550,y:-975,w:-1915,h:-1240,color:"blue"},{x:-1895,y:-1165,w:-2010,h:-1240,color:"blue"},{x:-1890,y:-940,w:-2095,h:-1080,color:"blue"},{x:-2130,y:-1320,w:-2245,h:-1400,color:"blue"},{x:-1990,y:-1405,w:-2045,h:-1480,color:"blue"},{x:-1420,y:-1705,w:-1475,h:-1765,color:"blue"},{x:-195,y:-1405,w:-295,h:-1485,color:"blue"},{x:-140,y:-1290,w:-240,h:-1370,color:"blue"},{x:160,y:-1170,w:115,h:-1250,color:"blue"},{x:805,y:-1215,w:650,h:-1320,color:"blue"},{x:810,y:-1235,w:655,h:-1355,color:"blue"},{x:805,y:-1225,w:655,h:-1275,color:"blue"},{x:650,y:-1265,w:550,h:-1350,color:"blue"},{x:545,y:-1340,w:460,h:-1405,color:"blue"},{x:-145,y:-1275,w:-255,h:-1340,color:"blue"},{x:-140,y:-1275,w:-250,h:-1310,color:"blue"},{x:-150,y:-1275,w:-250,h:-1305,color:"blue"},{x:535,y:-1320,w:485,h:-1365,color:"blue"},{x:-295,y:-1945,w:-410,h:-1975,color:"blue"},{x:-310,y:-1940,w:-410,h:-2040,color:"blue"},{x:-300,y:-1950,w:-350,h:-1975,color:"blue"},{x:-535,y:-1760,w:-695,h:-1855,color:"blue"},{x:735,y:-1365,w:650,h:-1435,color:"blue"},{x:-265,y:-2320,w:-325,h:-2395,color:"blue"},{x:-500,y:-1800,w:-575,h:-1865,color:"blue"},{x:-520,y:-1755,w:-705,h:-1840,color:"blue"},{x:-525,y:-1760,w:-690,h:-1835,color:"blue"},{x:-1275,y:-1910,w:-1460,h:-1985,color:"blue"},{x:-1330,y:-1965,w:-1410,h:-2025,color:"blue"},{x:-1305,y:-1950,w:-1345,h:-2e3,color:"blue"},{x:-1290,y:-1900,w:-1465,h:-1935,color:"blue"},{x:-1380,y:-1950,w:-1445,h:-2010,color:"blue"},{x:-670,y:-2045,w:-1550,h:-2090,color:"blue"},{x:-655,y:-2040,w:-1560,h:-2110,color:"blue"},{x:-2330,y:-1345,w:-2385,h:-1410,color:"blue"},{x:-2740,y:-1060,w:-3020,h:-1130,color:"blue"},{x:-2330,y:-1345,w:-2390,h:-1410,color:"blue"},{x:-2735,y:-1060,w:-3020,h:-1140,color:"blue"},{x:-2465,y:-670,w:-2585,h:-750,color:"blue"},{x:-2650,y:-410,w:-3070,h:-660,color:"blue"},{x:-2515,y:-420,w:-2685,h:-520,color:"blue"},{x:-2595,y:-485,w:-2690,h:-580,color:"blue"},{x:-3050,y:-570,w:-3115,h:-660,color:"blue"},{x:-3050,y:-415,w:-3155,h:-505,color:"blue"},{x:-1505,y:-2050,w:-1560,h:-2430,color:"blue"},{x:-1415,y:-2375,w:-1565,h:-2425,color:"blue"},{x:-1420,y:-2370,w:-1565,h:-2445,color:"blue"},{x:-805,y:-2085,w:-1380,h:-2345,color:"blue"},{x:-780,y:-2060,w:-830,h:-2335,color:"blue"},{x:-650,y:-2055,w:-700,h:-2375,color:"blue"},{x:-660,y:-2325,w:-775,h:-2395,color:"blue"},{x:-1315,y:-2310,w:-1385,h:-2360,color:"blue"},{x:80,y:460,w:-1200,h:315,color:"blue"},{x:-545,y:345,w:-810,h:265,color:"blue"},{x:-490,y:335,w:-560,h:280,color:"blue"},{x:-520,y:305,w:-565,h:285,color:"blue"},{x:-515,y:295,w:-560,h:285,color:"blue"},{x:-525,y:320,w:-570,h:275,color:"blue"},{x:200,y:460,w:45,h:415,color:"blue"},{x:175,y:460,w:55,h:400,color:"blue"},{x:165,y:430,w:45,h:360,color:"blue"},{x:140,y:400,w:60,h:345,color:"blue"},{x:125,y:380,w:65,h:340,color:"blue"},{x:115,y:375,w:45,h:305,color:"blue"},{x:-795,y:340,w:-855,h:280,color:"blue"},{x:-1190,y:470,w:-1315,h:405,color:"blue"},{x:-1190,y:435,w:-1230,h:350,color:"blue"},{x:-1230,y:440,w:-1270,h:395,color:"blue"},{x:-1215,y:445,w:-1265,h:375,color:"blue"},{x:-1180,y:395,w:-1225,h:345,color:"blue"},{x:-1225,y:395,w:-1260,h:380,color:"blue"},{x:-1715,y:-1940,w:-2640,h:-2030,color:"blue"},{x:-2040,y:-1920,w:-2400,h:-1980,color:"blue"},{x:-2580,y:-1965,w:-2650,h:-2400,color:"blue"},{x:-410,y:-2025,w:-605,h:-2095,color:"blue"},{x:-435,y:-2070,w:-585,h:-2150,color:"blue"},{x:-525,y:-2085,w:-680,h:-2195,color:"blue"},{x:-2025,y:-85,w:-2230,h:-190,color:"blue"},{x:-2065,y:-50,w:-2230,h:-100,color:"blue"},{x:-2415,y:450,w:-2680,h:340,color:"blue"},{x:-2555,y:410,w:-2650,h:325,color:"blue"},{x:-2610,y:355,w:-2680,h:245,color:"blue"},{x:-1697,y:-1962.5,w:-1757,h:-2432.5,color:"blue"},{x:-1702,y:-1967.5,w:-1767,h:-2432.5,color:"blue"},{x:-1707,y:-1952.5,w:-1762,h:-2447.5,color:"blue"},{x:-1762,y:-2102.5,w:-1897,h:-2217.5,color:"blue"},{x:-1762,y:-2087.5,w:-1897,h:-2222.5,color:"blue"},{x:-1917,y:-1992.5,w:-2092,h:-2107.5,color:"blue"},{x:-2062,y:-1942.5,w:-2197,h:-2167.5,color:"blue"},{x:-2082,y:-1982.5,w:-2392,h:-2072.5,color:"blue"},{x:-2042,y:-1997.5,w:-2077,h:-2172.5,color:"blue"},{x:-2227,y:-2017.5,w:-2387,h:-2162.5,color:"blue"},{x:-2437,y:-1992.5,w:-2612,h:-2102.5,color:"blue"},{x:-1747,y:-2367.5,w:-2252,h:-2442.5,color:"blue"},{x:-1762,y:-2302.5,w:-1862,h:-2367.5,color:"blue"},{x:-1747,y:-2292.5,w:-1852,h:-2377.5,color:"blue"},{x:-2467,y:-2372.5,w:-2782,h:-2432.5,color:"blue"},{x:-2632,y:-2337.5,w:-2797,h:-2397.5,color:"blue"},{x:-2657,y:-2467.5,w:-2732,h:-2542.5,color:"blue"},{x:-2187,y:-2452.5,w:-2237,h:-2527.5,color:"blue"},{x:-2457,y:-2477.5,w:-2542,h:-2572.5,color:"blue"},{x:-1082,y:-2457.5,w:-1142,h:-2532.5,color:"blue"},{x:-567,y:-2272.5,w:-627,h:-2337.5,color:"blue"},{x:-557,y:-2277.5,w:-657,h:-2352.5,color:"blue"},{x:-2672,y:-1267.5,w:-2852,h:-1352.5,color:"blue"},{x:-2957,y:-1252.5,w:-3142,h:-1332.5,color:"blue"},{x:-2992,y:-1332.5,w:-3112,h:-1367.5,color:"blue"},{x:-2992,y:-1302.5,w:-3102,h:-1372.5,color:"blue"},{x:-2857,y:-1307.5,w:-2957,h:-1362.5,color:"blue"},{x:-2857,y:-1307.5,w:-2962,h:-1377.5,color:"blue"},{x:-3322,y:-1847.5,w:-3842,h:-2152.5,color:"blue"},{x:-3322,y:-1847.5,w:-3697,h:-2157.5,color:"blue"},{x:-3262,y:-2017.5,w:-3362,h:-2097.5,color:"blue"},{x:-3227,y:-2057.5,w:-3302,h:-2122.5,color:"blue"},{x:-3262,y:-2002.5,w:-3342,h:-2042.5,color:"blue"},{x:-3662,y:-1892.5,w:-3842,h:-2147.5,color:"blue"},{x:778,y:-2212.5,w:628,h:-2337.5,color:"blue"},{x:783,y:-2217.5,w:598,h:-2327.5,color:"blue"},{x:798,y:-2342.5,w:533,h:-2522.5,color:"blue"},{x:708,y:-2282.5,w:603,h:-2427.5,color:"blue"},{x:808,y:-2397.5,w:518,h:-2522.5,color:"blue"},{x:803,y:-2402.5,w:538,h:-2512.5,color:"blue"},{x:803,y:-2562.5,w:358,h:-2632.5,color:"blue"},{x:408,y:-2577.5,w:353,h:-3027.5,color:"blue"},{x:468,y:-2947.5,w:358,h:-3027.5,color:"blue"},{x:403,y:-2997.5,w:358,h:-3052.5,color:"blue"},{x:783,y:-2582.5,w:623,h:-2872.5,color:"blue"},{x:793,y:-2607.5,w:443,h:-2767.5,color:"blue"},{x:613,y:-2637.5,w:448,h:-2877.5,color:"blue"},{x:683,y:-2732.5,w:563,h:-2797.5,color:"blue"},{x:673,y:-2722.5,w:563,h:-2822.5,color:"blue"},{x:658,y:-2782.5,w:573,h:-2847.5,color:"blue"},{x:-3657,y:-2347.5,w:-4052,h:-2657.5,color:"blue"},{x:-3762,y:-2612.5,w:-4047,h:-2722.5,color:"blue"},{x:-3752,y:-2632.5,w:-3787,h:-2717.5,color:"blue"},{x:-3617,y:-2522.5,w:-3682,h:-2612.5,color:"blue"},{x:-3147,y:-2707.5,w:-3207,h:-2782.5,color:"blue"},{x:-3122,y:-2882.5,w:-4047,h:-2972.5,color:"blue"},{x:-3137,y:-2937.5,w:-3317,h:-3082.5,color:"blue"},{x:-3127,y:-2907.5,w:-3327,h:-3087.5,color:"blue"},{x:-492,y:-3262.5,w:-677,h:-3342.5,color:"blue"},{x:-3332,y:-2992.5,w:-3502,h:-3242.5,color:"blue"},{x:-3342,y:-3197.5,w:-3502,h:-3267.5,color:"blue"},{x:-3512,y:-2977.5,w:-3682,h:-3257.5,color:"blue"},{x:-3422,y:-2987.5,w:-3532,h:-3222.5,color:"blue"},{x:-3432,y:-3162.5,w:-3587,h:-3207.5,color:"blue"},{x:-3442,y:-3162.5,w:-3542,h:-3222.5,color:"blue"},{x:-3447,y:-3177.5,w:-3552,h:-3222.5,color:"blue"},{x:-3437,y:-3182.5,w:-3557,h:-3242.5,color:"blue"},{x:-3687,y:-3082.5,w:-3932,h:-3317.5,color:"blue"},{x:-3087,y:-1697.5,w:-3167,h:-1797.5,color:"blue"},{x:-3217,y:-1707.5,w:-3327,h:-1797.5,color:"blue"},{x:123,y:-2467.5,w:53,h:-2542.5,color:"blue"},{x:528,y:-2127.5,w:438,h:-2187.5,color:"blue"},{x:528,y:-2112.5,w:433,h:-2192.5,color:"blue"},{x:-3092,y:-3267.5,w:-3162,h:-3352.5,color:"blue"},{x:-2172,y:-2952.5,w:-2642,h:-3352.5,color:"blue"},{x:-2022,y:-3012.5,w:-2202,h:-3187.5,color:"blue"},{x:-2132,y:-3197.5,w:-2197,h:-3337.5,color:"blue"},{x:-2222,y:-3317.5,w:-2352,h:-3392.5,color:"blue"},{x:-2327,y:-3317.5,w:-2427,h:-3502.5,color:"blue"},{x:-2317,y:-3332.5,w:-2637,h:-3497.5,color:"blue"},{x:-2607,y:-3042.5,w:-2717,h:-3312.5,color:"blue"},{x:-2592,y:-3052.5,w:-2692,h:-3282.5,color:"blue"},{x:-2607,y:-3237.5,w:-2667,h:-3292.5,color:"blue"},{x:-2662,y:-3157.5,w:-2742,h:-3217.5,color:"blue"},{x:-2667,y:-3067.5,w:-2717,h:-3122.5,color:"blue"},{x:-1167,y:-3267.5,w:-1342,h:-3342.5,color:"blue"},{x:-2612,y:-3497.5,w:-2677,h:-3537.5,color:"blue"},{x:-2602,y:-3487.5,w:-2682,h:-3542.5,color:"blue"},{x:-2707,y:-3482.5,w:-2772,h:-3537.5,color:"blue"},{x:-2797,y:-3477.5,w:-2877,h:-3532.5,color:"blue"},{x:-297,y:-3012.5,w:-497,h:-3087.5,color:"blue"},{x:-267,y:-3187.5,w:-457,h:-3262.5,color:"blue"},{x:-252,y:-3242.5,w:-337,h:-3327.5,color:"blue"},{x:-697,y:-3102.5,w:-797,h:-3192.5,color:"blue"},{x:-457,y:-3447.5,w:-552,h:-3527.5,color:"blue"},{x:-637,y:-3582.5,w:-747,h:-3662.5,color:"blue"},{x:-1602,y:-3442.5,w:-1707,h:-3527.5,color:"blue"},{x:-1587,y:-2957.5,w:-1777,h:-3047.5,color:"blue"},{x:-1177,y:-3012.5,w:-1372,h:-3092.5,color:"blue"},{x:-977,y:-3207.5,w:-1177,h:-3287.5,color:"blue"},{x:803,y:-3119.5,w:333,h:-3664.5,color:"blue"},{x:273,y:-3144.5,w:193,h:-3244.5,color:"blue"},{x:263,y:-3469.5,w:208,h:-3529.5,color:"blue"},{x:-1037,y:-3449.5,w:-1137,h:-3529.5,color:"blue"},{x:-1582,y:-3104.5,w:-1682,h:-3174.5,color:"blue"},{x:-2087,y:-2759.5,w:-2157,h:-2829.5,color:"blue"},{x:-542,y:-2759.5,w:-612,h:-2844.5,color:"blue"},{x:-3577,y:-1344.5,w:-3652,h:-1414.5,color:"blue"},{x:-3577,y:-1339.5,w:-3637,h:-1414.5,color:"blue"},{x:-3617,y:-1234.5,w:-3877,h:-1319.5,color:"blue"},{x:-2642,y:475.5,w:-3007,h:175.5,color:"blue"},{x:-2642,y:470.5,w:-4042,h:250.5,color:"blue"},{x:-2982,y:310.5,w:-4037,h:195.5,color:"blue"},{x:-3657,y:225.5,w:-4037,h:-289.5,color:"blue"},{x:-3612,y:-254.5,w:-3787,h:-364.5,color:"blue"},{x:-3717,y:-334.5,w:-3782,h:-399.5,color:"blue"},{x:-692,y:-3109.5,w:-797,h:-3179.5,color:"blue"},{x:-3857,y:-594.5,w:-3937,h:-734.5,color:"blue"},{x:-3857,y:-904.5,w:-3937,h:-1049.5,color:"blue"},{x:803,y:-254.5,w:408,h:-379.5,color:"blue"}],events:{doors:[{h:-2128,w:-2247,x:-2172,y:-2053,map:"house.png",other_pos:0,next_cor:{x:510-(1920-t.windowWidth)/2,y:-180-(922-t.windowHeight)/2}}]},depth:{path:'assets/maps/"main-map-depth.jpg"'},enemiesCount:10,size:"native",weather:!0,position:"native",type:"hostile"},"house.png":{colliders:[{x:723,y:260.5,w:633,h:-344.5,color:"blue"},{x:688,y:265.5,w:233,h:130.5,color:"blue"},{x:708,y:255.5,w:233,h:105.5,color:"blue"},{x:578,y:165.5,w:233,h:30.5,color:"blue"},{x:583,y:190.5,w:233,h:35.5,color:"blue"},{x:308,y:380.5,w:43,h:220.5,color:"blue"},{x:93,y:340.5,w:8,h:-369.5,color:"blue"},{x:688,y:-89.5,w:503,h:-224.5,color:"blue"},{x:493,y:-99.5,w:328,h:-209.5,color:"blue"},{x:438,y:-179.5,w:368,h:-249.5,color:"blue"},{x:443,y:-179.5,w:328,h:-239.5,color:"blue"},{x:428,y:-214.5,w:338,h:-254.5,color:"blue"},{x:688,y:-314.5,w:338,h:-354.5,color:"blue"},{x:398,y:-214.5,w:333,h:-399.5,color:"blue"},{x:403,y:-229.5,w:328,h:-399.5,color:"blue"},{x:173,y:210.5,w:103,h:140.5,color:"blue"},{x:223,y:140.5,w:148,h:85.5,color:"blue"},{x:213,y:120.5,w:143,h:-34.5,color:"blue"},{x:218,y:90.5,w:108,h:-24.5,color:"blue"},{x:223,y:85.5,w:98,h:-34.5,color:"blue"},{x:268,y:20.5,w:193,h:-54.5,color:"blue"},{x:268,y:20.5,w:188,h:-44.5,color:"blue"},{x:118,y:60.5,w:58,h:.5,color:"blue"},{x:223,y:125.5,w:138,h:75.5,color:"blue"},{x:158,y:100.5,w:93,h:70.5,color:"blue"},{x:243,y:25.5,w:188,h:-14.5,color:"blue"},{x:313,y:-99.5,w:248,h:-334.5,color:"blue"},{x:298,y:-94.5,w:148,h:-219.5,color:"blue"},{x:138,y:-94.5,w:38,h:-219.5,color:"blue"},{x:173,y:-89.5,w:143,h:-164.5,color:"blue"},{x:178,y:-99.5,w:143,h:-199.5,color:"blue"},{x:128,y:-244.5,w:43,h:-309.5,color:"blue"},{x:133,y:-239.5,w:43,h:-299.5,color:"blue"},{x:133,y:-239.5,w:43,h:-314.5,color:"blue"},{x:258,y:-279.5,w:78,h:-309.5,color:"blue"},{x:268,y:-169.5,w:238,h:-309.5,color:"blue"},{x:263,y:-299.5,w:83,h:-309.5,color:"blue"},{x:268,y:-164.5,w:233,h:-354.5,color:"blue"}],events:{doors:[{x:355.5,y:-279.5,w:280.5,h:-339.5,map:"main-map.jpg",other_pos:1,next_cor:{x:-2020-(1920-t.windowWidth)/2,y:-2053-(922-t.windowHeight)/2}}]},enemiesCount:0,depth:{path:'assets/maps/"house-depth.png"'},size:{width:850,height:850},weather:!1,type:"calm"}};class Ct{constructor(e){a(this,"startPoint");a(this,"w");a(this,"h");a(this,"img");a(this,"depthImg");a(this,"name");a(this,"mapData");a(this,"otherMaps");a(this,"otherMapsDepth");this.startPoint=new s(-2220+t.adjustDeviceColliderX,-2220+t.adjustDeviceColliderY),this.w=4800,this.h=4080,this.name=e,this.img=new Image,this.img.src="./assets/maps/"+this.name,this.otherMaps=[this.img],this.depthImg=new Image,this.depthImg.src="./assets/maps/"+this.getDepthImgName(),this.mapData=Z;let i=new Image;i.src="assets/maps/house.png",this.otherMaps=[i],i=new Image,i.src="assets/maps/house-depth.png",this.otherMapsDepth=[i],this.otherMaps.push(this.img),this.otherMapsDepth.push(this.depthImg)}getDepthImgName(){let e=this.name.split("."),i;return e.splice(1,0,"-depth."),i=e.join(""),i}show(e=t.ctx){if(e.clearRect(0,0,t.windowWidth,t.windowHeight),e.fillStyle="#181425",e.fillRect(0,0,t.windowWidth,t.windowHeight),this.checkEvents(),this.w==0&&this.h==0&&this.mapData[this.name].size=="native")e.drawImage(this.img,this.startPoint.x,this.startPoint.y);else{const i=this.mapData[this.name].size;i=="native"?e.drawImage(this.img,this.startPoint.x,this.startPoint.y):e.drawImage(this.img,this.startPoint.x,this.startPoint.y,i.width,i.height)}}showDepth(e=t.ctx){this.mapData[this.name].size=="native"?e.drawImage(this.depthImg,this.startPoint.x,this.startPoint.y):e.drawImage(this.depthImg,this.startPoint.x,this.startPoint.y,this.mapData[this.name].size.width,this.mapData[this.name].size.height)}checkEvents(e=this.startPoint.x,i=this.startPoint.y){this.mapData[this.name].events.doors.map(n=>{e-t.adjustDeviceColliderX<n.x&&e-t.adjustDeviceColliderX>n.w&&i-t.adjustDeviceColliderY<n.y&&i-t.adjustDeviceColliderY>n.h&&(this.startPoint.x=n.next_cor.x,this.startPoint.y=n.next_cor.y,this.name=n.map,this.img=this.otherMaps[n.other_pos],this.depthImg=this.otherMapsDepth[n.other_pos])})}checkCollision(e,i){let n=!1,r=this.mapData[this.name].colliders.length;for(let l=0;l<r;l++){let h=this.mapData[this.name].colliders[l];if(!t.debugCollider&&e-t.adjustDeviceColliderX<h.x&&e-t.adjustDeviceColliderX>h.w&&i-t.adjustDeviceColliderY<h.y&&i-t.adjustDeviceColliderY>h.h){n=!0;break}}return n}}const G=1,Ft="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/lantern/lantern-right.png",tt=new Image;tt.src=Ft;const x={sprite:tt,width:55,height:74,position:[new s(30,30),new s(123,30),new s(230,30),new s(320,30),new s(430,30)]};class Rt{constructor(){a(this,"x");a(this,"y");a(this,"img");a(this,"maxRadiusInnerCircle");a(this,"maxRadiusOuterCircle");a(this,"decreaseLuminosity");a(this,"setLuminosityInterval");a(this,"resetLuminosityInterval");a(this,"brightnessDecreaseRate");a(this,"spritePos");a(this,"r");a(this,"blowingLantern");this.decreaseLuminosity=null,this.setLuminosityInterval=null,this.resetLuminosityInterval=null,this.x=t.player.startPoint.x+15,this.y=t.player.startPoint.y+45,this.img=new Image,this.maxRadiusInnerCircle=250,this.maxRadiusOuterCircle=Math.max(t.windowWidth,t.windowHeight)/2,this.brightnessDecreaseRate=G,this.spritePos=0,this.r=14,this.blowingLantern=null}show(e=t.ctx){if(t.player.isBlowingLantern?this.blowingLantern||(this.blowingLantern=setInterval(()=>{this.r<28?this.r+=1:(clearInterval(this.blowingLantern),this.blowingLantern=null)},100)):this.r=14,t.player.direction=="l"){e.fillStyle="rgba(255, 170, 51, 0.04)";for(let r=0;r<this.r;r++)u(e,this.x+10,this.y+20,r*3,r*3);const i=t.player.isRunning?5:8;let n=t.player.isWalking||t.player.isRunning?Math.floor(this.spritePos/i)%5:0;e.drawImage(x.sprite,x.position[n].x,x.position[n].y,x.width,x.height,this.x,this.y,25,30),(t.player.isWalking||t.player.isRunning)&&this.spritePos++}if(t.player.direction=="r"){e.fillStyle="rgba(255, 170, 51, 0.04)";for(let r=0;r<this.r;r++)u(e,this.x+5,this.y+20,r*3,r*3);const i=t.player.isRunning?5:8;let n=t.player.isWalking||t.player.isRunning?Math.floor(this.spritePos/i)%5:0;e.drawImage(x.sprite,x.position[n].x,x.position[n].y,x.width,x.height,this.x-5,this.y,25,30),(t.player.isWalking||t.player.isRunning)&&this.spritePos++}if(t.player.direction=="u"){e.fillStyle="rgba(255, 170, 51, 0.04)";for(let i=0;i<this.r;i++)u(e,this.x-5,this.y+10,i*3,i*3);e.drawImage(this.img,this.x-25,this.y-10,40,40)}if(t.player.direction=="d"){e.fillStyle="rgba(255, 170, 51, 0.04)";for(let i=0;i<this.r;i++)u(e,this.x-5,this.y+15,i*3,i*3);e.drawImage(this.img,this.x-25,this.y-10,40,40)}}showLuminosity(){const e=t.ctx.createRadialGradient(this.x+5,this.y+35,this.maxRadiusInnerCircle,this.x+5,this.y+35,this.maxRadiusOuterCircle);e.addColorStop(0,"rgba(0, 0, 0, 0)"),e.addColorStop(.1,"rgba(0, 0, 0, 0.8)"),e.addColorStop(.2,"rgba(0, 0, 0, 0.9)"),e.addColorStop(1,"rgba(0, 0, 0, 1)"),t.ctx.fillStyle=e,t.ctx.fillRect(0,0,m.width,m.height)}changeLuminosity(){this.decreaseLuminosity||(this.decreaseLuminosity=setInterval(()=>{this.maxRadiusInnerCircle<=0?(this.maxRadiusInnerCircle=0,clearInterval(this.decreaseLuminosity),this.decreaseLuminosity=null):t.gameState!=c.paused&&(this.maxRadiusInnerCircle-=this.brightnessDecreaseRate)},200))}resetLuminosity(){this.brightnessDecreaseRate=G,this.resetLuminosityInterval=setInterval(()=>{this.maxRadiusInnerCircle==250?(clearInterval(this.resetLuminosityInterval),this.resetLuminosityInterval=null):this.maxRadiusInnerCircle>250?this.maxRadiusInnerCircle-=1:this.maxRadiusInnerCircle<250&&(this.maxRadiusInnerCircle+=1)},2)}setLuminosity(){this.brightnessDecreaseRate=0,this.setLuminosityInterval=setInterval(()=>{this.maxRadiusInnerCircle>=Math.max(m.width/2,m.height/2)?(this.maxRadiusInnerCircle=Math.max(m.width/2,m.height/2),clearInterval(this.setLuminosityInterval),this.setLuminosityInterval=null):this.maxRadiusInnerCircle+=1},2)}}const Wt="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/enemy/goblin/left/Png/GoblinBeastLeftAttack01.png",Ht="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/enemy/goblin/left/Png/GoblinBeastLeftDeath.png",jt="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/enemy/goblin/right/Png/GoblinBeastRightAttack01.png",Xt="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/enemy/goblin/right/Png/GoblinBeastRightDeath.png",Yt="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/enemy/goblin/front/Png/GoblinBeastDownAttack01.png",Bt="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/enemy/goblin/front/Png/GoblinBeastDownDeath.png",$t="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/enemy/goblin/back/Png/GoblinBeastUpAttack01.png",Ot="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/enemy/goblin/back/Png/GoblinBeastUpDeath.png",et=new Image;et.src=Wt;const it=new Image;it.src=Ht;const st=new Image;st.src=jt;const ot=new Image;ot.src=Xt;const at=new Image;at.src=Yt;const rt=new Image;rt.src=Bt;const nt=new Image;nt.src=$t;const lt=new Image;lt.src=Ot;const M={attackType1:{sprite:et,height:48,width:48,position:[new s(20,16),new s(85,17),new s(146,17),new s(210,17),new s(270,16),new s(331,17),new s(398,17),new s(462,17)],offset:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]},enemyDead:{sprite:it,height:48,width:48,position:[new s(12,8),new s(63,12),new s(111,14),new s(147,30),new s(193,30),new s(243,30),new s(387,30),new s(435,30)],offset:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]}},D={attackType1:{sprite:st,height:48,width:48,position:[new s(20,16),new s(82,17),new s(143,17),new s(206,17),new s(280,16),new s(350,17),new s(414,17),new s(470,17)],offset:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]},enemyDead:{sprite:ot,height:48,width:48,position:[new s(12,8),new s(60,12),new s(108,14),new s(159,30),new s(207,30),new s(255,30),new s(399,30),new s(447,30)],offset:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]}},C={attackType1:{sprite:at,height:48,width:48,position:[new s(20,16),new s(84,17),new s(145,17),new s(208,17),new s(272,23),new s(343,25),new s(402,25),new s(460,25)],offset:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]},enemyDead:{sprite:rt,height:48,width:48,position:[new s(12,8),new s(61,13),new s(109,15),new s(157,27),new s(205,27),new s(253,27),new s(397,27),new s(445,27)],offset:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]}},F={attackType1:{sprite:nt,height:48,width:48,position:[new s(20,16),new s(84,17),new s(145,17),new s(208,17),new s(272,16),new s(343,9),new s(402,3),new s(460,0)],offset:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]},enemyDead:{sprite:lt,height:48,width:48,position:[new s(12,8),new s(61,13),new s(109,15),new s(157,27),new s(205,27),new s(253,27),new s(397,27),new s(445,27)],offset:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]}};class zt{constructor(e,i){a(this,"startPoint");a(this,"images_back");a(this,"images_front");a(this,"images_left");a(this,"images_right");a(this,"MAX_HEALTH");a(this,"MIN_HEALTH");a(this,"damage");a(this,"health");a(this,"movement_speed");a(this,"finalX");a(this,"finalY");a(this,"direction");a(this,"time");a(this,"h");a(this,"w");a(this,"r");a(this,"default_movement_speed");a(this,"default_damage");a(this,"default_health");a(this,"damageTimeout");a(this,"isAttacking");a(this,"spritePos");a(this,"attackType");a(this,"isAlive");this.startPoint=new s(e,i),this.direction="d",this.h=P(80,100),this.w=this.h,this.r=40,this.MAX_HEALTH=5,this.MIN_HEALTH=2,this.default_damage=1,this.damage=this.default_damage,this.images_back=[],this.images_front=[],this.images_left=[],this.images_right=[],this.time=0,this.damageTimeout=null,this.default_health=Math.random()*(this.MAX_HEALTH-this.MIN_HEALTH)+this.MIN_HEALTH,this.health=this.default_health,this.default_movement_speed=1,this.movement_speed=Math.random()+this.default_movement_speed,this.finalX=t.player.startPoint.x,this.finalY=t.player.startPoint.y,this.isAttacking=!1,this.spritePos=0,this.attackType="attackType1",this.isAlive=!0}initialiseGolblinImages(e,i){const n=r=>{const l=[];for(let h=1;h<=i;h++){const y=new Image;y.src=`${e}/${r}/${r} (${h}).png`,l.push(y)}return l};this.images_back=n("back"),this.images_front=n("front"),this.images_left=n("left"),this.images_right=n("right")}updateAttributes(){f(this.startPoint,t.player.startPoint)>t.lantern.maxRadiusInnerCircle*2?(this.movement_speed=this.default_movement_speed*2,this.damage=this.default_damage*2,this.health=this.default_health*2):(this.movement_speed=this.default_movement_speed,this.damage=this.default_damage)}determineDirection(){const e=z(new s(this.finalX,this.finalY),this.startPoint)*(180/Math.PI);e>=-45&&e<45?this.direction="r":e>=45&&e<135?this.direction="d":e>=-135&&e<-45?this.direction="u":this.direction="l"}show(e=t.ctx){if(Math.floor(this.health)>0){if(this.isAttacking){let l=Math.floor(this.spritePos/5)%8;this.direction=="l"?e.drawImage(M[this.attackType].sprite,M[this.attackType].position[l].x-10,M[this.attackType].position[l].y-10,48,48,this.startPoint.x,this.startPoint.y,this.w,this.h):this.direction=="r"?e.drawImage(D[this.attackType].sprite,D[this.attackType].position[l].x-10,D[this.attackType].position[l].y-10,48,48,this.startPoint.x,this.startPoint.y,this.w,this.h):this.direction=="d"?e.drawImage(C[this.attackType].sprite,C[this.attackType].position[l].x-10,C[this.attackType].position[l].y-10,48,48,this.startPoint.x,this.startPoint.y,this.w,this.h):this.direction=="u"&&e.drawImage(F[this.attackType].sprite,F[this.attackType].position[l].x-10,F[this.attackType].position[l].y-10,48,48,this.startPoint.x,this.startPoint.y,this.w,this.h)}else if(!this.isAttacking){let l=Math.floor(this.spritePos/5)%this.images_right.length,h=this.images_right[l];this.direction=="r"?h=this.images_right[l]:this.direction=="l"?h=this.images_left[l]:this.direction=="u"?h=this.images_back[l]:this.direction=="d"&&(h=this.images_front[l]),this.startPoint.x>-100&&this.startPoint.x<t.windowWidth&&this.startPoint.y>-100&&this.startPoint.y<t.windowHeight&&e.drawImage(h,this.startPoint.x,this.startPoint.y,this.w,this.h)}this.spritePos++,e.fillStyle="rgba(20, 20, 20, 0.6)",e.beginPath();const i=this.w/3,n=this.h/10;e.ellipse(this.startPoint.x+this.w/2,this.startPoint.y+this.h-10,i,n,0,0,2*Math.PI),e.fill()}else{let n=Math.floor(this.spritePos/5)%8;this.direction=="l"?e.drawImage(M.enemyDead.sprite,M.enemyDead.position[n].x-10,M.enemyDead.position[n].y-10,48,48,this.startPoint.x,this.startPoint.y,this.w,this.h):this.direction=="r"?e.drawImage(D.enemyDead.sprite,D.enemyDead.position[n].x-10,D.enemyDead.position[n].y-10,48,48,this.startPoint.x,this.startPoint.y,this.w,this.h):this.direction=="d"?e.drawImage(C.enemyDead.sprite,C.enemyDead.position[n].x-10,C.enemyDead.position[n].y-10,48,48,this.startPoint.x,this.startPoint.y,this.w,this.h):this.direction=="u"&&e.drawImage(F.enemyDead.sprite,F.enemyDead.position[n].x-10,F.enemyDead.position[n].y-10,48,48,this.startPoint.x,this.startPoint.y,this.w,this.h),this.spritePos++,this.spritePos%40==0&&(this.isAlive=!1)}}move(){if(this.health>0){let e=f(t.player.startPoint,this.startPoint);if(e<1e3){let i=this.finalX-this.startPoint.x,n=this.finalY-this.startPoint.y,r=f(new s(this.finalX,this.finalY),this.startPoint);if(e>50){if(r>this.movement_speed){let l=this.movement_speed/r,h=l*i,y=l*n;t.bgImage.checkCollision(t.bgImage.startPoint.x-this.startPoint.x+this.finalX,t.bgImage.startPoint.y-this.startPoint.y+this.finalY+this.movement_speed)?this.startPoint.x=h+this.startPoint.x:t.bgImage.checkCollision(t.bgImage.startPoint.x-this.startPoint.x+this.finalX+this.movement_speed,t.bgImage.startPoint.y-this.startPoint.y+this.finalY)?this.startPoint.y=y+this.startPoint.y:(this.startPoint.x=h+this.startPoint.x,this.startPoint.y=y+this.startPoint.y),this.isAttacking=!1}}else{let l=Math.atan2(this.startPoint.y-t.player.startPoint.y,this.startPoint.x-t.player.startPoint.x),h=t.player.startPoint.x+Math.cos(l)*40,y=t.player.startPoint.y+Math.sin(l)*40,w=.05;this.startPoint.x+=(h-this.startPoint.x)*w,this.startPoint.y+=(y-this.startPoint.y)*w,this.isAttacking=!0,this.attack()}}}}attack(){t.player.health>0?this.damageTimeout||(this.damageTimeout=setTimeout(()=>{t.player.health-=this.damage,this.damageTimeout=null},500)):clearTimeout(this.damageTimeout)}separate(){let e=0,i=0;t.enemiesArray.forEach(n=>{if(this!=n){let r=this.startPoint.x-n.startPoint.x,l=this.startPoint.y-n.startPoint.y,h=Math.sqrt(r*r+l*l);if(h<40&&h>0){let y=(40-h)/40*20;e+=r/h*y,i+=l/h*y}}}),this.startPoint.x+=e,this.startPoint.y+=i}}class N{constructor(e,i=5){a(this,"no_of_frames");a(this,"frameIndex");a(this,"time");a(this,"has_more_than_one_state");a(this,"animation_speed");a(this,"frames_array");this.has_more_than_one_state=!1,this.animation_speed=i,this.frames_array=e,typeof e=="object"&&(this.has_more_than_one_state=!0),this.no_of_frames=e.length,this.frameIndex=0,this.time=0}change_frames(){let e=this.animation_speed;this.time>e&&(this.frameIndex+=1,this.frameIndex==this.frames_array.length&&(this.frameIndex=0),this.time=0),this.time++}frame(){return this.frameIndex}}class q{constructor(){a(this,"slope");a(this,"startPoint");a(this,"c");this.slope=1,this.startPoint=new s(Math.floor(Math.random()*1920),Math.random()*1e3),this.c=this.startPoint.y-this.startPoint.x*this.slope}show(e=t.ctx){let i=Math.random()*100;e.strokeStyle="rgb(200, 200, 200)",e.beginPath(),e.moveTo(this.startPoint.x,this.startPoint.y),e.lineTo(this.generateX(this.startPoint.y+i),this.startPoint.y+i),e.stroke()}move(){this.startPoint.y=this.startPoint.y+Math.random()*30,this.startPoint.x=this.generateX(this.startPoint.y)}generateX(e){return(e-this.c)/this.slope}}class Ut{constructor(){a(this,"healthImages");a(this,"overlayImages");a(this,"staminaImage");a(this,"healthBars");a(this,"staminaBars");a(this,"rainParticles");this.healthImages=[],this.staminaImage={},this.overlayImages=[],this.healthBars=5,this.staminaBars=5,this.rainParticles=[]}initialiseImages(e){const i=n=>{const r=new Image;return r.src=n,r};this.healthImages[0]=i(`${e}/border.png`),this.healthImages[1]=i(`${e}/health.png`),this.staminaImage=i(`${e}/stamina.png`),this.healthImages[2]=i(`${e}/empty.png`),this.overlayImages[0]=i(`${e}/bloodOverlay.png`)}renderBloodOverlay(e=t.ctx){e.drawImage(this.overlayImages[0],0,0,t.windowWidth,t.windowHeight)}renderScore(e=t.ctx){e.font="40px Outfit",e.textAlign="right",e.fillStyle="white";const i=t.windowWidth-30;e.fillText(`Score: ${t.player.score}`,i,40)}renderHealth(e=t.ctx){(t.player.health<30||t.lantern.maxRadiusInnerCircle<80)&&this.renderBloodOverlay(),e.font="14px Outfit",e.textAlign="left",e.fillStyle="white",e.fillText("Health",35,28);let i=0;for(let n=0;n<this.healthBars;n++)e.drawImage(this.healthImages[0],50+(n+1)*30+10,10,30,30),t.player.health>i?e.drawImage(this.healthImages[1],50+(n+1)*30+10,10,30,30):e.drawImage(this.healthImages[2],50+(n+1)*30+10,10,30,30),i+=100/this.healthBars}renderStamina(e=t.ctx){e.font="14px Outfit",e.textAlign="left",e.fillStyle="white",e.fillText("Stamina",300,28);let i=0;for(let n=0;n<this.staminaBars;n++)e.drawImage(this.healthImages[0],330+(n+1)*30+10,10,30,30),t.player.stamina>i?e.drawImage(this.staminaImage,330+(n+1)*30+10,10,30,30):e.drawImage(this.healthImages[2],330+(n+1)*30+10,10,30,30),i+=100/this.staminaBars;t.player.stamina<100&&(t.player.stamina+=.1)}initialiseRainParticles(){for(let e=0;e<200;e++)this.rainParticles[e]=new q}renderRainParticles(){let e=0;this.rainParticles.forEach(i=>{i.show(),i.move(),i.startPoint.y>1920&&(this.rainParticles[e]=new q),e+=1})}}function Nt(){const o=new FontFace("Nos","url(assets/font/Nos.ttf)");document.fonts.add(o);const e=new FontFace("stat","url(assets/font/stat.ttf)");document.fonts.add(e);const i=new FontFace("Outfit","url(assets/font/Outfit.ttf)");document.fonts.add(i)}class Kt{constructor(){a(this,"startPoint");a(this,"hoveredOption");a(this,"hoveredChar");a(this,"difficultyLevel");a(this,"selectedChar");a(this,"difficulties");a(this,"menuItems");a(this,"charItems");a(this,"charInfo");a(this,"characterImages");this.startPoint=new s(t.windowWidth/15,150),this.hoveredOption=-1,this.hoveredChar=-1,this.difficultyLevel=0,this.selectedChar=0,this.difficulties=["GENOCIDE","HOMICIDE","SUICIDE"],this.menuItems=[{text:"Eclipse of the Lantern",fontSize:t.windowWidth/25,x:this.startPoint.x,y:this.startPoint.y+t.windowWidth/15*0,type:1},{text:"START JOURNEY",fontSize:t.windowWidth/25,x:this.startPoint.x,y:this.startPoint.y+t.windowWidth/20*2,type:0},{text:"DIFFICULTY: ",fontSize:t.windowWidth/20,x:this.startPoint.x,y:this.startPoint.y+t.windowWidth/20*3,type:0}],this.charItems=[{text:"SELECT CHARACTER",x:t.windowWidth/1.5+100,y:280},{text:"<",x:t.windowWidth/1.5,y:480},{text:">",x:t.windowWidth/1.5+400,y:480}],this.characterImages=[],this.charInfo=[{name:"Ophelia"},{name:"Noah"}]}initialiseImages(){this.charInfo.forEach(e=>{const i=new Image;i.src=`assets/character/images/characters/profile/${e.name}.png`,this.characterImages.push(i)})}updateMenuItems(){t.gameState==c.menuScreen?(this.menuItems=[{text:"Eclipse of the Lantern",fontSize:t.windowWidth/25,x:this.startPoint.x,y:this.startPoint.y+t.windowWidth/15*0,type:1},{text:"START JOURNEY",fontSize:t.windowWidth/25,x:this.startPoint.x,y:this.startPoint.y+t.windowWidth/20*2,type:0},{text:"DIFFICULTY: ",fontSize:t.windowWidth/20,x:this.startPoint.x,y:this.startPoint.y+t.windowWidth/20*3,type:0}],this.charItems=[{text:"SELECT CHARACTER",x:t.windowWidth/1.5+100,y:280},{text:"<",x:t.windowWidth/1.5,y:480},{text:">",x:t.windowWidth/1.5+400,y:480}]):t.gameState==c.paused?(this.menuItems=[{text:"Eclipse of the Lantern",fontSize:t.windowWidth/25,x:this.startPoint.x,y:this.startPoint.y+t.windowWidth/15*0,type:1},{text:"RESUME",fontSize:t.windowWidth/25,x:this.startPoint.x,y:this.startPoint.y+t.windowWidth/20*2,type:0},{text:"QUIT",fontSize:t.windowWidth/20,x:this.startPoint.x,y:this.startPoint.y+t.windowWidth/20*3,type:0}],this.charItems=[]):t.gameState==c.retryScreen?(this.menuItems=[{text:"Eclipse of the Lantern",fontSize:t.windowWidth/25,x:this.startPoint.x,y:this.startPoint.y+t.windowWidth/15*0,type:1},{text:"RETRY",fontSize:t.windowWidth/25,x:this.startPoint.x,y:this.startPoint.y+t.windowWidth/20*2,type:0},{text:"QUIT",fontSize:t.windowWidth/20,x:this.startPoint.x,y:this.startPoint.y+t.windowWidth/20*3,type:0}],this.charItems=[]):t.gameState==c.gameFinish&&(this.menuItems=[{text:"Eclipse of the Lantern",fontSize:t.windowWidth/25,x:this.startPoint.x,y:this.startPoint.y+t.windowWidth/15*0,type:1},{text:"CONGRATULATIONS! You conquered the enemies.",fontSize:t.windowWidth/25,x:this.startPoint.x,y:this.startPoint.y+t.windowWidth/20*2,type:0},{text:"QUIT",fontSize:t.windowWidth/20,x:this.startPoint.x,y:this.startPoint.y+t.windowWidth/20*3,type:0}],this.charItems=[])}show(e=t.ctx){this.updateMenuItems(),e.fillStyle="rgba(0, 0, 0, 0.74)",e.fillRect(0,0,t.windowWidth,t.windowHeight),e.textAlign="left",e.font="30px Nos";let i=0,n=!0,r=t.mouseCoords.x,l=t.mouseCoords.y;this.menuItems.forEach(h=>{e.font=`${h.fontSize}px Nos`,e.fillStyle="rgb(255, 255, 255)";let y=!1;r>=h.x&&r<h.x+h.text.length/1.5*h.fontSize&&l<=h.y&&l>h.y-h.fontSize&&(y=!0,this.hoveredOption=i,n=!1),h.type==1||y?i>0&&(e.font="30px stat",e.fillStyle="red"):(e.font="30px stat",e.fillStyle="rgb(255, 255, 255)"),t.gameState==c.menuScreen&&i==2?e.fillText(h.text+this.difficulties[this.difficultyLevel],h.x,h.y):e.fillText(h.text,h.x,h.y),i++}),t.gameState==c.menuScreen&&(n&&(this.hoveredOption=-1),n=!0,i=0,this.charItems.forEach(h=>{e.fillStyle="rgb(255, 255, 255)",r>=h.x&&r<h.x+50&&l<=h.y&&l>h.y-50&&(e.fillStyle="red",n=!1,this.hoveredChar=i),e.fillText(h.text,h.x,h.y),i++}),n&&(this.hoveredChar=-1),e.drawImage(this.characterImages[this.selectedChar],t.windowWidth/1.5+140,500,100,100),e.font="40px stat",e.textAlign="center",e.fillStyle="rgb(255, 255, 255)",e.fillText(this.charInfo[this.selectedChar].name,t.windowWidth/1.5+200,450,500),e.font="20px stat")}handleSelect(){t.gameState==c.menuScreen?((this.hoveredChar==1||this.hoveredChar==2)&&(this.selectedChar=this.selectedChar==0?1:0),this.hoveredOption==2&&(this.difficultyLevel<this.difficulties.length-1?this.difficultyLevel++:this.difficultyLevel=0)):this.hoveredOption==2&&(t.gameState=c.menuScreen),t.gameState!=c.gameFinish&&this.hoveredOption==1&&(b.difficultyLevel=this.difficultyLevel,b.character=this.charInfo[this.selectedChar].name,t.gameState==c.paused?ke():Pe())}}const Gt="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/pickups/fuel/fuel.png",ht=new Image;ht.src=Gt;const $={sprite:ht,width:24,height:25,position:[new s(0,0),new s(24,0),new s(48,0),new s(72,0),new s(96,0),new s(120,0),new s(144,0),new s(168,0)]};class qt{constructor(e,i,n){a(this,"images");a(this,"startPoint");a(this,"isUsed");a(this,"type");a(this,"frameCount");a(this,"spritePos");this.images=[],this.startPoint=new s(e,i),this.isUsed=!1,this.type=n,this.frameCount=11,this.spritePos=0}initialiseImages(){for(let e=1;e<=this.frameCount;e++){const i=new Image;i.src=`${this.type.images_path}${this.type.itemName} (${e}).png`,this.images[e-1]=i}}show(e,i,n=t.ctx){const r=this.startPoint.x,l=this.startPoint.y;let h=r+16,y=l+40,w=i+10,p=i+5;if(this.type.itemName=="fuel"){let K=Math.floor(this.spritePos/5)%8;n.drawImage($.sprite,$.position[K].x,$.position[K].y,$.width,$.height,r,l,30,30),this.spritePos++}else if(this.type.itemName=="health_pack")h=r+30,y=l+50,w=i+14,p=i+4,n.drawImage(e,r,l,60,60);else if(this.type.itemName=="ammo"){w=i+22;const T=new Image;T.src="./assets/inventory/ammo.png",n.drawImage(T,r,l,30,30)}n.fillStyle="rgba(20, 20, 20, 150)",n.beginPath(),n.ellipse(h,y,w/2,p/2,0,0,Math.PI*2),n.fill()}collect(){f(this.startPoint,t.player.startPoint)<50&&(this.type.itemName=="health_pack"?d.medKit++:this.type.itemName=="fuel"?d.fuel++:this.type.itemName=="ammo"&&(d.ammo+=50),this.isUsed=!0)}}class Qt{constructor(){a(this,"fuelImg");a(this,"medKitImg");a(this,"ammoImg");a(this,"abilities");a(this,"showMessage");this.fuelImg={},this.medKitImg={},this.ammoImg={},this.abilities=[{name:"Light of Blessings",src:"assets/abilities/light.png",maxCooldown:30,cooldown:0,cooldownInterval:0},{name:"Breath of Dragon",src:"assets/abilities/flame.png",maxCooldown:20,cooldown:0,cooldownInterval:0}],this.showMessage=!1}initialiseImages(){const e=i=>{const n=new Image;return n.src=i,n};this.fuelImg=e("./assets/inventory/fuel.png"),this.medKitImg=e("./assets/inventory/medkit.png"),this.ammoImg=e("./assets/inventory/ammo.png")}show(e=t.ctx){e.font="18px Outfit",e.textAlign="right",e.fillStyle="white",e.fillText("Items",80,100),e.textAlign="center",e.fillStyle="white",e.font="16px Outfit",e.drawImage(this.medKitImg,30,120,40,40),e.fillText(`x ${d.medKit}`,100,145,100),e.drawImage(this.fuelImg,30,180,40,40),e.fillText(`x ${d.fuel}`,100,210,100),e.drawImage(this.ammoImg,30,240,40,40),e.fillText(`x ${d.ammo}`,100,265,100),this.displayWeapons(),this.displayAbilities()}displayMessage(e=t.ctx,i,n){e.textAlign="center",e.fillStyle="white",e.font="24px Outfit",i=="health_pack"&&e.fillText("Out of Med Kit!",m.width/2,m.height-50,400),i=="fuel"&&e.fillText("Out of Fuel!",m.width/2,m.height-50,400),i=="ammo"&&e.fillText("Out of Ammo!",m.width/2,m.height-50,400),n&&e.fillText(n,m.width/2,m.height-50,400)}displayWeapons(e=t.ctx){e.font="18px Outfit",e.textAlign="left",e.fillStyle="white",e.fillText("Weapons",30,320);const i=30,n="#333";let r=30;const l=350;e.strokeStyle=n,e.lineWidth=2,e.strokeRect(r,l,i,i),t.player.currWeapon=="axe"&&(e.strokeStyle="aqua",e.lineWidth=2,e.strokeRect(r-2,l-2,i+4,i+4));const h=new Image;h.src="assets/axe.png",e.drawImage(h,r,l,i,i),r=80,e.strokeStyle=n,e.lineWidth=2,e.strokeRect(r,l,i,i),t.player.currWeapon=="gun"&&(e.strokeStyle="aqua",e.lineWidth=2,e.strokeRect(r-2,l-2,i+4,i+4));const y=new Image;y.src="assets/gun.png",e.drawImage(y,r,l,i,i)}displayAbilities(e=t.ctx){const n="#333",r=t.windowWidth-215;e.font="18px Outfit",e.textAlign="left",e.fillStyle="white",e.fillText("Abilities",r,120);for(let[l,h]of this.abilities.entries()){const y=h.cooldown,w=h.maxCooldown;let p=150+l*70;e.strokeStyle=n,e.lineWidth=2,e.strokeRect(r,p,40,40);const T=new Image;T.src=h.src,e.drawImage(T,r,p,40,40),e.font="14px Outfit",e.textAlign="right",e.fillStyle="white",e.fillText(h.name,t.windowWidth-40,p+25),y>0&&(e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(r+1,p+40/w*(w-y)+2,38,40-40/w*(w-y)-2),e.fillStyle="white",e.font="16px Outfit",e.textAlign="center",e.textBaseline="middle",e.fillText(`${y}s`,r+40/2,p+40/2),h.cooldownInterval||(h.cooldownInterval=setInterval(()=>{h.cooldown>0&&t.gameState!=c.paused&&h.cooldown--},1e3)))}}resetAbility(e){e=="light"&&(this.abilities[0].cooldown=this.abilities[0].maxCooldown),e=="flame"&&(this.abilities[1].cooldown=this.abilities[1].maxCooldown)}}const Jt="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/weapons/axe-left/axe-left.png",Vt="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/weapons/axe-right/axe-right.png",Zt="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/weapons/axe-back/back.png",te="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/weapons/axe-front/front.png",yt=new Image;yt.src=Jt;const ct=new Image;ct.src=Vt;const mt=new Image;mt.src=Zt;const dt=new Image;dt.src=te;const k={sprite:yt,height:54,position:[new s(0,0),new s(77,0),new s(141,0),new s(228,0),new s(312,0),new s(392,0),new s(487,0),new s(564,0)],offset:[{x:12,y:10},{x:0,y:10},{x:-24,y:18},{x:-24,y:32},{x:-28,y:44},{x:-26,y:32},{x:-24,y:18},{x:12,y:10}],width:[32,30,49,51,38,49,30,32]},v={sprite:ct,height:54,position:[new s(0,0),new s(77,0),new s(155,0),new s(245,0),new s(317,0),new s(411,0),new s(487,0),new s(564,0)],offset:[{x:-25,y:10},{x:10,y:10},{x:20,y:28},{x:20,y:44},{x:20,y:28},{x:20,y:20},{x:-12,y:10},{x:-24,y:10}],width:[32,30,49,51,50,60,30,32]},A={sprite:dt,height:50,position:[new s(0,0),new s(26,0),new s(37,0)],offset:[{x:28,y:8},{x:28,y:8},{x:28,y:8}],width:[9,9,9]},_={sprite:mt,height:50,position:[new s(1,0),new s(34,0),new s(47,0)],offset:[{x:30,y:10},{x:30,y:10},{x:30,y:10}],width:[8,8,8]};class ee{constructor(){a(this,"startPoint");a(this,"r");a(this,"spritePos");a(this,"shockPoint");this.startPoint=t.player.startPoint,this.r=50,this.spritePos=0,this.shockPoint=new s(0,0)}show(e=t.ctx,i){if(t.player.direction=="r"){let r=i?Math.floor(this.spritePos/5)%8:0;e.drawImage(v.sprite,v.position[r].x,v.position[r].y,v.width[r],v.height,t.player.startPoint.x+v.offset[r].x,t.player.startPoint.y+v.offset[r].y,50,50),i&&(this.spritePos++,this.spritePos%40==0&&(t.player.isAttacking=!1))}else if(t.player.direction=="l"){let r=i?Math.floor(this.spritePos/5)%8:0;e.drawImage(k.sprite,k.position[r].x,k.position[r].y,k.width[r],k.height,t.player.startPoint.x+k.offset[r].x,t.player.startPoint.y+k.offset[r].y,50,50),i&&(this.spritePos++,this.spritePos%40==0&&(t.player.isAttacking=!1))}else if(t.player.direction=="u"){let r=i?Math.floor(this.spritePos/14)%3:0;e.drawImage(_.sprite,_.position[r].x,_.position[r].y,_.width[r],_.height,t.player.startPoint.x+_.offset[r].x,t.player.startPoint.y+_.offset[r].y,8,50),i&&(this.spritePos++,this.spritePos%42==0&&(t.player.isAttacking=!1))}else if(t.player.direction=="d"){let r=i?Math.floor(this.spritePos/14)%3:0;e.drawImage(A.sprite,A.position[r].x,A.position[r].y,A.width[r],A.height,t.player.startPoint.x+A.offset[r].x,t.player.startPoint.y+A.offset[r].y,8,50),i&&(this.spritePos++,this.spritePos%42==0&&(t.player.isAttacking=!1))}e.fillStyle="rgba(20, 20, 20,0.55)",e.beginPath(),e.ellipse(this.shockPoint.x,this.shockPoint.y,10,10,0,0,Math.PI*2),e.fill(),e.closePath()}calculateShockPoint(){const e=Math.atan2(t.mouseCoords.y-t.player.startPoint.y,t.mouseCoords.x-t.player.startPoint.x),i=Math.sin(e)*this.r,n=Math.cos(e)*this.r;this.shockPoint=new s(this.startPoint.x+n+20,this.startPoint.y+i+50)}hits(e){return f(new s(this.shockPoint.x,this.shockPoint.y),new s(e.startPoint.x+e.w/2,e.startPoint.y+e.h/2))<this.r}}const ie="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/weapons/gun-left/gun-left.png",se="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/weapons/gun-right/gun-right.png",oe="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/weapons/gun-back/gun-back.png",ae="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/weapons/gun-front/gun-front.png",wt=new Image;wt.src=ie;const gt=new Image;gt.src=se;const pt=new Image;pt.src=oe;const ft=new Image;ft.src=ae;const g={sprite:wt,height:65,position:[new s(0,0),new s(136,0),new s(274,0),new s(408,0)],offset:[{x:-8,y:24},{x:-8,y:20},{x:-8,y:22},{x:-8,y:24}],width:[116,116,110,116]},S={sprite:gt,height:65,position:[new s(0,0),new s(137,0),new s(270,0),new s(408,0)],offset:[{x:-4,y:24},{x:-4,y:20},{x:-4,y:22},{x:-4,y:24}],width:[116,110,116,116]},L={sprite:ft,height:28,position:[new s(3,0),new s(50,0),new s(99,0),new s(144,0)],offset:[{x:32,y:14},{x:32,y:14},{x:32,y:14},{x:32,y:14}],width:[19,20,18,19]},E={sprite:pt,height:28,position:[new s(1,0),new s(41,0),new s(88,0),new s(127,0)],offset:[{x:32,y:10},{x:32,y:10},{x:32,y:10},{x:32,y:10}],width:[22,26,20,20]};class re{constructor(e,i,n){a(this,"startPoint");a(this,"initialX");a(this,"initialY");a(this,"r");a(this,"endPoint");a(this,"movement_speed");a(this,"dir");a(this,"toDelete");this.startPoint=new s(e.x-30,e.y+30),this.dir=i,this.initialX=this.startPoint.x,this.initialY=this.startPoint.y,this.r=5,this.endPoint=new s(n.x*1.05,n.y*1.05),this.movement_speed=20,this.toDelete=!1}show(e=t.ctx){e.strokeStyle="none",e.fillStyle="rgb(255, 255, 100)",u(e,this.startPoint.x,this.startPoint.y,this.r*1.5,this.r*1.5),e.fillStyle="rgba(255, 170, 51, 0.016)";for(let i=0;i<this.r*4;i++)u(e,this.initialX-10,this.initialY,i*3,i*3);e.save(),e.translate(this.startPoint.x,this.startPoint.y),e.rotate(Math.atan2(this.startPoint.y-this.endPoint.y,this.startPoint.x-this.endPoint.x));for(let i=0;i<this.r*4;i++)u(e,0,0,i*5,i);e.restore()}hits(e){return f(new s(this.startPoint.x-100,this.startPoint.y-130),new s(e.startPoint.x-50,e.startPoint.y-50))<this.r+e.r}evaporate(){this.toDelete=!0}move(){let e=this.endPoint.x-this.startPoint.x,i=this.endPoint.y-this.startPoint.y,n=f(this.endPoint,this.startPoint);if(n>this.movement_speed){let r=this.movement_speed/n,l=r*e,h=r*i;this.startPoint.x=l+this.startPoint.x,this.startPoint.y=h+this.startPoint.y}else this.startPoint.x=this.endPoint.x,this.startPoint.y=this.endPoint.y,this.evaporate()}}class ne{constructor(){a(this,"startPoint");a(this,"spritePos");this.startPoint=t.player.startPoint,this.spritePos=0}show(e=t.ctx,i){if(t.player.direction=="r"){let r=i?Math.floor(this.spritePos/5)%4:0;if(e.drawImage(S.sprite,S.position[r].x,S.position[r].y,S.width[r],S.height,t.player.startPoint.x+S.offset[r].x,t.player.startPoint.y+S.offset[r].y,50,50),i){e.fillStyle="rgba(255, 170, 51, 0.04)";for(let l=0;l<14;l++)u(e,t.player.startPoint.x+S.offset[r].x+50,t.player.startPoint.y+S.offset[r].y+20,l*3,l*3);this.spritePos++,this.spritePos%20==0&&(t.player.isAttacking=!1)}}else if(t.player.direction=="l"){let r=i?Math.floor(this.spritePos/5)%4:0;if(e.drawImage(g.sprite,g.position[r].x,g.position[r].y,g.width[r],g.height,t.player.startPoint.x+g.offset[r].x,t.player.startPoint.y+g.offset[r].y,50,50),i){e.fillStyle="rgba(255, 170, 51, 0.04)";for(let l=0;l<14;l++)u(e,t.player.startPoint.x+g.offset[r].x,t.player.startPoint.y+g.offset[r].y+20,l*3,l*3);this.spritePos++,this.spritePos%20==0&&(t.player.isAttacking=!1)}}else if(t.player.direction=="u"){let r=i?Math.floor(this.spritePos/5)%4:0;if(e.drawImage(E.sprite,E.position[r].x,E.position[r].y,E.width[r],E.height,t.player.startPoint.x+E.offset[r].x,t.player.startPoint.y+E.offset[r].y,8,50),i){e.fillStyle="rgba(255, 170, 51, 0.04)";for(let l=0;l<14;l++)u(e,t.player.startPoint.x+g.offset[r].x+45,t.player.startPoint.y+g.offset[r].y,l*3,l*3);this.spritePos++,this.spritePos%20==0&&(t.player.isAttacking=!1)}}else if(t.player.direction=="d"){let r=i?Math.floor(this.spritePos/5)%4:0;if(e.drawImage(L.sprite,L.position[r].x,L.position[r].y,L.width[r],L.height,t.player.startPoint.x+L.offset[r].x,t.player.startPoint.y+L.offset[r].y,8,50),i){e.fillStyle="rgba(255, 170, 51, 0.04)";for(let l=0;l<14;l++)u(e,t.player.startPoint.x+g.offset[r].x+45,t.player.startPoint.y+g.offset[r].y+10,l*3,l*3);this.spritePos++,this.spritePos%20==0&&(t.player.isAttacking=!1)}}}fire(){const e=z(new s(t.mouseCoords.x,t.mouseCoords.y),t.player.startPoint)*(180/Math.PI);e>=-45&&e<45?t.player.direction="r":e>=45&&e<135?t.player.direction="d":e>=-135&&e<-45?t.player.direction="u":t.player.direction="l";const i=new re(new s(t.player.startPoint.x+60,t.player.startPoint.y+20),t.player.direction,new s(t.mouseCoords.x,t.mouseCoords.y));t.bulletProjectileArray.push(i),d.ammo--}}const le="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/boss/left/Png/GoblinBeastLeftAttack01.png",he="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/boss/left/Png/GoblinBeastLeftDeath.png",ye="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/boss/right/Png/GoblinBeastRightAttack01.png",ce="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/boss/right/Png/GoblinBeastRightDeath.png",me="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/boss/front/Png/GoblinBeastDownAttack01.png",de="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/boss/front/Png/GoblinBeastDownDeath.png",we="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/boss/back/Png/GoblinBeastUpAttack01.png",ge="/LF-SE-Fellowship-2024-Minor-Project-Eclipse-of-the-Lantern/assets/boss/back/Png/GoblinBeastUpDeath.png",ut=new Image;ut.src=le;const xt=new Image;xt.src=he;const bt=new Image;bt.src=ye;const Pt=new Image;Pt.src=ce;const It=new Image;It.src=me;const St=new Image;St.src=de;const kt=new Image;kt.src=we;const vt=new Image;vt.src=ge;const R={attackType1:{sprite:ut,height:48,width:48,position:[new s(20,16),new s(85,17),new s(146,17),new s(210,17),new s(270,16),new s(331,17),new s(398,17),new s(462,17)],offset:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]},enemyDead:{sprite:xt,height:48,width:48,position:[new s(12,8),new s(63,12),new s(111,14),new s(147,30),new s(193,30),new s(243,30),new s(387,30),new s(435,30)],offset:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]}},W={attackType1:{sprite:bt,height:48,width:48,position:[new s(20,16),new s(82,17),new s(143,17),new s(206,17),new s(280,16),new s(350,17),new s(414,17),new s(470,17)],offset:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]},enemyDead:{sprite:Pt,height:48,width:48,position:[new s(12,8),new s(60,12),new s(108,14),new s(159,30),new s(207,30),new s(255,30),new s(399,30),new s(447,30)],offset:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]}},H={attackType1:{sprite:It,height:48,width:48,position:[new s(20,16),new s(84,17),new s(145,17),new s(208,17),new s(272,23),new s(343,25),new s(402,25),new s(460,25)],offset:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]},enemyDead:{sprite:St,height:48,width:48,position:[new s(12,8),new s(61,13),new s(109,15),new s(157,27),new s(205,27),new s(253,27),new s(397,27),new s(445,27)],offset:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]}},j={attackType1:{sprite:kt,height:48,width:48,position:[new s(20,16),new s(84,17),new s(145,17),new s(208,17),new s(272,16),new s(343,9),new s(402,3),new s(460,0)],offset:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]},enemyDead:{sprite:vt,height:48,width:48,position:[new s(12,8),new s(61,13),new s(109,15),new s(157,27),new s(205,27),new s(253,27),new s(397,27),new s(445,27)],offset:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]}};class At{constructor(){a(this,"startPoint");a(this,"images_back");a(this,"images_front");a(this,"images_left");a(this,"images_right");a(this,"damage");a(this,"health");a(this,"movement_speed");a(this,"finalX");a(this,"finalY");a(this,"direction");a(this,"time");a(this,"h");a(this,"w");a(this,"r");a(this,"default_movement_speed");a(this,"default_damage");a(this,"default_health");a(this,"damageTimeout");a(this,"abilityTimeout");a(this,"isAttacking");a(this,"spritePos");a(this,"attackType");a(this,"isAlive");a(this,"hasWakeUp");a(this,"spawnEnemyInterval");let e,i;Math.random()<.5?(e=P(t.bgImage.startPoint.x,t.bgImage.startPoint.x+100),i=P(t.bgImage.startPoint.y,t.bgImage.startPoint.y+t.bgImage.h)):(e=P(t.bgImage.startPoint.x,t.bgImage.startPoint.x+t.bgImage.w),i=P(t.bgImage.startPoint.y,t.bgImage.startPoint.y+100)),this.startPoint=new s(e,i),this.direction="d",this.h=150,this.w=this.h,this.r=80,this.default_damage=2,this.damage=this.default_damage,this.images_back=[],this.images_front=[],this.images_left=[],this.images_right=[],this.time=0,this.damageTimeout=null,this.abilityTimeout=null,this.default_health=100,this.health=this.default_health,this.default_movement_speed=2,this.movement_speed=this.default_movement_speed,this.finalX=t.player.startPoint.x,this.finalY=t.player.startPoint.y,this.isAttacking=!1,this.spritePos=0,this.attackType="attackType1",this.isAlive=!0,this.hasWakeUp=!1,this.spawnEnemyInterval=null,this.initialiseGolblinImages("assets/boss/",6)}initialiseGolblinImages(e,i){const n=r=>{const l=[];for(let h=1;h<=i;h++){const y=new Image;y.src=`${e}/${r}/${r} (${h}).png`,l.push(y)}return l};this.images_back=n("back"),this.images_front=n("front"),this.images_left=n("left"),this.images_right=n("right")}updateAttributes(){f(this.startPoint,t.player.startPoint)>t.lantern.maxRadiusInnerCircle*2?(this.movement_speed=this.default_movement_speed*2,this.damage=this.default_damage*2,this.health=this.default_health*2):(this.movement_speed=this.default_movement_speed,this.damage=this.default_damage)}determineDirection(){const e=z(new s(this.finalX,this.finalY),this.startPoint)*(180/Math.PI);e>=-45&&e<45?this.direction="r":e>=45&&e<135?this.direction="d":e>=-135&&e<-45?this.direction="u":this.direction="l"}show(e=t.ctx){if(Math.floor(this.health)>0){if(this.isAttacking){let l=Math.floor(this.spritePos/5)%8;this.direction=="l"?e.drawImage(R[this.attackType].sprite,R[this.attackType].position[l].x-10,R[this.attackType].position[l].y-10,48,48,this.startPoint.x,this.startPoint.y,this.w,this.h):this.direction=="r"?e.drawImage(W[this.attackType].sprite,W[this.attackType].position[l].x-10,W[this.attackType].position[l].y-10,48,48,this.startPoint.x,this.startPoint.y,this.w,this.h):this.direction=="d"?e.drawImage(H[this.attackType].sprite,H[this.attackType].position[l].x-10,H[this.attackType].position[l].y-10,48,48,this.startPoint.x,this.startPoint.y,this.w,this.h):this.direction=="u"&&e.drawImage(j[this.attackType].sprite,j[this.attackType].position[l].x-10,j[this.attackType].position[l].y-10,48,48,this.startPoint.x,this.startPoint.y,this.w,this.h)}else if(!this.isAttacking){let l=Math.floor(this.spritePos/5)%this.images_right.length,h=this.images_right[l];this.direction=="r"?h=this.images_right[l]:this.direction=="l"?h=this.images_left[l]:this.direction=="u"?h=this.images_back[l]:this.direction=="d"&&(h=this.images_front[l]),e.drawImage(h,this.startPoint.x,this.startPoint.y,this.w,this.h)}this.spritePos++,e.fillStyle="rgba(20, 20, 20, 0.6)",e.beginPath();const i=this.w/3,n=this.h/10;e.ellipse(this.startPoint.x+this.w/2,this.startPoint.y+this.h-10,i,n,0,0,2*Math.PI),e.fill()}else if(this.isAlive){let n=Math.floor(this.spritePos/5)%8;this.direction=="l"?e.drawImage(R.enemyDead.sprite,R.enemyDead.position[n].x-10,R.enemyDead.position[n].y-10,48,48,this.startPoint.x,this.startPoint.y,this.w,this.h):this.direction=="r"?e.drawImage(W.enemyDead.sprite,W.enemyDead.position[n].x-10,W.enemyDead.position[n].y-10,48,48,this.startPoint.x,this.startPoint.y,this.w,this.h):this.direction=="d"?e.drawImage(H.enemyDead.sprite,H.enemyDead.position[n].x-10,H.enemyDead.position[n].y-10,48,48,this.startPoint.x,this.startPoint.y,this.w,this.h):this.direction=="u"&&e.drawImage(j.enemyDead.sprite,j.enemyDead.position[n].x-10,j.enemyDead.position[n].y-10,48,48,this.startPoint.x,this.startPoint.y,this.w,this.h),this.spritePos++,this.spritePos%40==0&&(this.isAlive=!1)}}move(){if(this.health>0&&(f(t.player.startPoint,this.startPoint)<400&&(this.hasWakeUp=!0),this.hasWakeUp)){let i=this.finalX-this.startPoint.x,n=this.finalY-this.startPoint.y,r=f(new s(this.finalX,this.finalY),this.startPoint);if(r>this.movement_speed){let l=this.movement_speed/r,h=l*i,y=l*n;t.bgImage.checkCollision(this.startPoint.x+h,this.startPoint.y)||(this.startPoint.x+=h),t.bgImage.checkCollision(this.startPoint.x,this.startPoint.y+y)||(this.startPoint.y+=y),this.isAttacking=!1,t.player.health>0?this.abilityTimeout||(this.abilityTimeout=setTimeout(()=>{this.useAbility(),this.abilityTimeout=null},P(2,4)*1e3)):clearTimeout(this.abilityTimeout)}else this.isAttacking=!0,this.attack()}}spawnEnemy(){!this.hasWakeUp&&t.enemiesArray.length<50?this.spawnEnemyInterval||(this.spawnEnemyInterval=setInterval(()=>{t.gameState!=c.paused&&(Lt(1),_t(1))},1e3)):(clearInterval(this.spawnEnemyInterval),this.spawnEnemyInterval=null)}attack(){t.player.health>0?this.damageTimeout||(this.damageTimeout=setTimeout(()=>{t.player.health-=this.damage,this.damageTimeout=null},400)):clearTimeout(this.damageTimeout)}useAbility(){const e=new V(new s(this.startPoint.x+this.w/2,this.startPoint.y+50),this.direction,new s(t.player.startPoint.x,t.player.startPoint.y),"boss");t.fireProjectileArray.push(e)}}function pe(){t.player=new Dt,t.player.initialiseImages(`assets/character/images/characters/${b.character}`,4),console.log(b.character),t.player.direction="r",t.player.startPoint.x=t.windowWidth/2,t.player.startPoint.y=t.windowHeight/2,t.ui=new Ut,t.cursorImage=new Image,t.cursorImage.src="./assets/attack.png",t.inventory=new Qt,t.axe=new ee,t.gun=new ne,t.inventory.initialiseImages(),t.ui.initialiseImages("./assets/ui"),t.ui.initialiseRainParticles(),t.lantern=new Rt,t.lantern.img.src="assets/lantern/lantern.png",t.bgImage=new Ct("main-map.jpg"),t.mainMenu=new Kt,t.boss=new At;let o=new N(t.boss.images_front,2);t.animateEnemyArray.push(o),t.mainMenu.initialiseImages(),Nt(),t.flameImages=ue("assets/flame",30)}function fe(){Z[t.bgImage.name].colliders.forEach(o=>{t.ctx.fillStyle=o.color||"#ffffff",t.ctx.beginPath(),t.ctx.fillRect(20+(t.windowWidth/2+t.bgImage.startPoint.x-(o.x+t.adjustDeviceColliderX)),50+(t.windowHeight/2+t.bgImage.startPoint.y-(o.y+t.adjustDeviceColliderY)),Math.abs(o.x-o.w),Math.abs(o.y-o.h))})}function ue(o,e){const i=[];for(let n=0;n<e;n++){const r=new Image;r.src=`${o}/${n}.png`,i.push(r)}return i}function xe(){m.width=window.innerWidth,m.height=window.innerHeight}function be(){(t.player.health<=0||t.lantern.maxRadiusInnerCircle<=0)&&(t.gameState=c.retryScreen)}function Pe(){ve(),t.gameState=c.running,Lt(50),_t(100),t.player.initialiseImages(`assets/character/images/characters/${b.character}`,4),console.log(b.character),t.player.direction="r",t.player.startPoint.x=t.windowWidth/2,t.player.startPoint.y=t.windowHeight/2,t.enemiesArray.forEach(o=>{o.MAX_HEALTH=O[b.difficultyLevel].enemyMaxHealth,o.MIN_HEALTH=O[b.difficultyLevel].enemyMinHealth,o.default_damage=O[b.difficultyLevel].enemyAttackDamage,o.default_movement_speed=O[b.difficultyLevel].enemySpeed})}function Ie(o=t.ctx){o.save(),t.player.abilityMode?(t.cursorImage.src="./assets/direction.png",o.translate(t.mouseCoords.x,t.mouseCoords.y),o.rotate(Math.atan2(t.mouseCoords.y-t.player.startPoint.y+50,t.mouseCoords.x-t.player.startPoint.x+30)),o.drawImage(t.cursorImage,0,0,50,50),o.restore()):t.player.currWeapon=="gun"?(t.cursorImage.src="./assets/crosshair.png",o.drawImage(t.cursorImage,t.mouseCoords.x,t.mouseCoords.y,30,30)):(t.cursorImage.src="./assets/attack.png",o.drawImage(t.cursorImage,t.mouseCoords.x,t.mouseCoords.y,30,30))}function _t(o){for(;o!=0;){const e=Math.random()<.8?Math.random()<.5?U.ammo:U.health_pack:U.fuel;let i=P(t.bgImage.startPoint.x,t.bgImage.startPoint.x+t.bgImage.w),n=P(t.bgImage.startPoint.y,t.bgImage.startPoint.y+t.bgImage.h);if(!t.bgImage.checkCollision(i,n)){const r=new qt(i,n,e);r.initialiseImages(),t.pickupItemsArray.push(r);const l=new N(r.images,12);t.animatePickupItemsArray.push(l),o--}}}function Se(){for(let o=0;o<t.pickupItemsArray.length;o++)t.pickupItemsArray[o].show(t.pickupItemsArray[o].images[t.animatePickupItemsArray[o].frame()],t.animatePickupItemsArray[o].frame()),t.animatePickupItemsArray[o].change_frames(),t.pickupItemsArray[o].collect(),t.pickupItemsArray[o].isUsed&&(t.pickupItemsArray.splice(o,1),t.animatePickupItemsArray.splice(o,1))}function ke(){t.gameState=c.running}function ve(){t.player.health=100,t.player.score=0,t.lantern.maxRadiusInnerCircle=250,t.bgImage.startPoint=new s(-2220+t.adjustDeviceColliderX,-2220+t.adjustDeviceColliderY),t.boss=new At,t.bloodParticleArray=[],t.bulletProjectileArray=[],t.fireProjectileArray=[],t.enemiesArray=[],t.pickupItemsArray=[],t.keyState={},t.animateEnemyArray=[],t.animatePickupItemsArray=[],t.inventory.abilities[0].cooldown=0,t.inventory.abilities[1].cooldown=0,d.medKit=0,d.fuel=0,d.ammo=100}function Ae(){t.inventory.show()}function _e(){t.ui.renderHealth(),t.ui.renderStamina(),t.ui.renderScore()}function Q(){t.mainMenu.show()}function Le(){t.enemiesArray.forEach(o=>{o.show(),o.move(),o.determineDirection(),o.updateAttributes(),o.separate()})}function Ee(){t.boss.show(),t.boss.move(),t.boss.determineDirection(),t.boss.updateAttributes(),t.boss.spawnEnemy()}function Te(o){const e=m.getBoundingClientRect(),i=o.clientX-e.left,n=o.clientY-e.top;return{x:i,y:n}}function Me(){t.bulletProjectileArray.forEach(o=>{o.show(),o.move()}),t.bulletProjectileArray=t.bulletProjectileArray.filter(o=>!o.toDelete),t.fireProjectileArray.forEach(o=>{o.show(),o.move()}),t.fireProjectileArray=t.fireProjectileArray.filter(o=>!o.toDelete)}function J(){let o=0,e="";t.isHoldingRefuelKey?(o=t.refuelDuration,e=" Refueling Lantern"):t.isHoldingHealKey&&(o=t.healDuration,e=" Using Med Kit");const i=new Date().getTime();let n=0;t.isHoldingHealKey&&(n=i-t.healStart),t.isHoldingRefuelKey&&(n=i-t.refuelStart);const r=o-n;r<0&&(t.isHoldingHealKey=!1,t.isHoldingRefuelKey=!1);const l=1-Math.min(n/o,1),h=400,y=20,w=(t.windowWidth-h)/2,p=t.windowHeight-50;t.ctx.fillStyle="#ccc",t.ctx.fillRect(w,p,h,y),t.ctx.fillStyle="#76c7c0",t.ctx.fillRect(w,p,h*l,y),t.ctx.font="16px Outfit",t.ctx.fillStyle="#fff",t.ctx.textAlign="center",t.ctx.fillText(`${e} ${(r/1e3).toFixed(1)}s`,t.windowWidth/2,p-10)}function Lt(o){for(;o!=0;){let e=P(t.bgImage.startPoint.x,t.bgImage.startPoint.x+t.bgImage.w),i=P(t.bgImage.startPoint.y,t.bgImage.startPoint.y+t.bgImage.h);if(!t.bgImage.checkCollision(e,i)){let n=new zt(e,i);n.initialiseGolblinImages("assets/enemy/goblin",6);let r=new N(n.images_front,2);t.enemiesArray.push(n),t.animateEnemyArray.push(r),o--}}}function u(o,e,i,n,r){o.beginPath(),o.ellipse(e,i,n/2,r/2,0,0,Math.PI*2),o.fill(),o.closePath()}function De(){if(t.player.currWeapon=="gun")t.bulletProjectileArray.forEach(o=>{for(let e=0;e<t.enemiesArray.length;e++)if(o.hits(t.enemiesArray[e])){t.enemiesArray[e].health-=1,o.evaporate();const i=new B(t.enemiesArray[e].startPoint.x-t.bgImage.startPoint.x,t.enemiesArray[e].startPoint.y-t.bgImage.startPoint.y);i.initialiseImages("assets/blood",7),t.bloodParticleArray.push(i)}});else if(t.player.currWeapon=="axe"&&t.player.isAttacking){for(let o=0;o<t.enemiesArray.length;o++)if(t.axe.hits(t.enemiesArray[o])){t.enemiesArray[o].health-=.1;const e=new B(t.enemiesArray[o].startPoint.x-t.bgImage.startPoint.x,t.enemiesArray[o].startPoint.y-t.bgImage.startPoint.y);e.initialiseImages("assets/blood",7),t.bloodParticleArray.push(e)}}t.fireProjectileArray.forEach(o=>{if(o.owner=="player"){for(let e=0;e<t.enemiesArray.length;e++)if(o.hits(t.enemiesArray[e])){t.enemiesArray[e].health-=5;const i=new B(t.enemiesArray[e].startPoint.x-t.bgImage.startPoint.x,t.enemiesArray[e].startPoint.y-t.bgImage.startPoint.y);i.initialiseImages("assets/blood",7),t.bloodParticleArray.push(i),t.enemiesArray[e].isAlive||(t.player.score++,t.enemiesArray.splice(e,1),t.animateEnemyArray.splice(e,1))}}else o.owner=="boss"&&o.hits(t.player)&&(t.player.health-=10)});for(let o=0;o<t.enemiesArray.length;o++)t.enemiesArray[o].isAlive||(t.player.score++,t.enemiesArray.splice(o,1),t.animateEnemyArray.splice(o,1));for(let o=t.bloodParticleArray.length-1;o>=0;o--)t.bloodParticleArray[o].showAnimation(),t.bloodParticleArray[o].show||t.bloodParticleArray.splice(o,1)}function Ce(){if(t.boss.health>0){if(t.boss.hasWakeUp){if(t.player.currWeapon=="gun")t.bulletProjectileArray.forEach(o=>{if(o.hits(t.boss)){t.boss.health-=1,o.evaporate();const e=new B(t.boss.startPoint.x-t.bgImage.startPoint.x,t.boss.startPoint.y-t.bgImage.startPoint.y);e.initialiseImages("assets/blood",7),t.bloodParticleArray.push(e)}});else if(t.player.currWeapon=="axe"&&t.player.isAttacking&&t.axe.hits(t.boss)){t.boss.health-=.1;const o=new B(t.boss.startPoint.x-t.bgImage.startPoint.x,t.boss.startPoint.y-t.bgImage.startPoint.y);o.initialiseImages("assets/blood",7),t.bloodParticleArray.push(o)}t.fireProjectileArray.forEach(o=>{if(o.owner=="player"&&o.hits(t.boss)){t.boss.health-=10;const e=new B(t.boss.startPoint.x-t.bgImage.startPoint.x,t.boss.startPoint.y-t.bgImage.startPoint.y);e.initialiseImages("assets/blood",7),t.bloodParticleArray.push(e)}})}}else t.boss.isAlive=!1}window.addEventListener("keydown",function(o){t.keyState[o.keyCode||o.which]=!0},!0);window.addEventListener("keyup",function(o){t.keyState[o.keyCode||o.which]=!1},!0);window.addEventListener("mousemove",function(o){t.mouseCoords=Te(o)},!0);window.addEventListener("click",function(){t.gameState!=c.running&&t.mainMenu.handleSelect()},!0);window.addEventListener("click",()=>{if(t.gameState==c.running&&!t.player.isBlowingLantern&&t.player.health>0){const o=z(new s(t.mouseCoords.x,t.mouseCoords.y),t.player.startPoint)*(180/Math.PI);o>=-45&&o<45?t.player.direction="r":o>=45&&o<135?t.player.direction="d":o>=-135&&o<-45?t.player.direction="u":t.player.direction="l",t.player.abilityMode?t.player.useAbility("flame"):t.player.currWeapon=="gun"?d.ammo>0?(t.player.isAttacking=!0,t.gun.fire()):t.inventory.displayMessage(t.ctx,"ammo"):t.player.currWeapon=="axe"&&(t.player.isAttacking=!0,t.axe.calculateShockPoint())}});let X=null,Y=null;function Fe(){t.keyState[87]&&t.keyState[68]?(t.player.direction="u",t.player.dirX=-.72,t.player.dirY=.72,t.player.move()):t.keyState[87]&&t.keyState[65]?(t.player.direction="u",t.player.dirX=.72,t.player.dirY=.72,t.player.move()):t.keyState[83]&&t.keyState[65]?(t.player.direction="d",t.player.dirX=.72,t.player.dirY=-.72,t.player.move()):t.keyState[83]&&t.keyState[68]?(t.player.direction="d",t.player.dirX=-.72,t.player.dirY=-.72,t.player.move()):t.keyState[65]?(t.player.direction="l",t.player.dirX=1,t.player.dirY=0,t.player.move()):t.keyState[68]?(t.player.direction="r",t.player.dirX=-1,t.player.dirY=0,t.player.move()):t.keyState[83]?(t.player.direction="d",t.player.dirX=0,t.player.dirY=-1,t.player.move()):t.keyState[87]?(t.player.direction="u",t.player.dirX=0,t.player.dirY=1,t.player.move()):(t.player.frameToShow=0,t.player.dirX=0,t.player.dirY=0,t.player.isWalking=!1),t.keyState[76]?t.debugCollider=!0:t.debugCollider=!1,t.keyState[69]&&t.player.useAbility("light"),t.keyState[80]&&(t.gameState=c.paused),t.keyState[82]?t.inventory.abilities[1].cooldown==0?t.player.abilityMode=!0:t.inventory.displayMessage(t.ctx,"","Ability on Cooldown!"):t.player.abilityMode=!1,t.keyState[16]&&!t.player.isBlowingLantern&&!t.player.isUsingMedkit?(t.player.frameTime=2,t.player.increaseSpeed(),t.player.isRunning=!0):(t.player.movement_speed=t.player.default_speed,t.player.frameTime=4,t.player.isRunning=!1),t.keyState[81]?I.Q||(t.player.currWeapon=t.player.currWeapon=="axe"?"gun":"axe",I.Q=!0):I.Q=!1,t.keyState[32]?I.SPACE||(!Y&&t.player.health>0&&(d.medKit>0?(t.healStart=new Date().getTime(),t.isHoldingHealKey=!0,t.player.isUsingMedkit=!0,Y=setTimeout(()=>{t.player.increaseHealth(),Y=null,t.player.isUsingMedkit=!1,t.isHoldingHealKey=!1,t.healStart=null},t.healDuration)):t.inventory.displayMessage(t.ctx,"health_pack")),I.SPACE=!0):(Y&&t.player.health>0&&(clearTimeout(Y),Y=null,t.isHoldingHealKey=!1,t.player.isUsingMedkit=!1,t.healStart=null),I.SPACE=!1),t.keyState[70]?I.F||(!X&&t.player.health>0&&(d.fuel>0?(t.refuelStart=new Date().getTime(),t.isHoldingRefuelKey=!0,t.player.isBlowingLantern=!0,X=setTimeout(()=>{t.lantern.resetLuminosity(),d.fuel--,X=null,t.player.isBlowingLantern=!1,t.isHoldingRefuelKey=!1,t.refuelStart=null},t.refuelDuration)):t.inventory.displayMessage(t.ctx,"fuel")),I.F=!0):(X&&t.player.health>0&&(clearTimeout(X),X=null,t.isHoldingRefuelKey=!1,t.player.isBlowingLantern=!1,t.refuelStart=null),I.F=!1)}const m=document.querySelector("#gameCanvas");t.ctx=m.getContext("2d");m.width=t.windowWidth;m.height=t.windowHeight;pe();function Et(){xe(),t.bgImage.show(),t.gameState==c.running&&(t.ui.renderRainParticles(),Se(),De(),t.player.show(),Le(),Ee(),Ce(),t.bgImage.showDepth(),t.lantern.showLuminosity(),t.lantern.changeLuminosity(),Me(),_e(),Ae(),Fe(),t.enemiesArray.length==0&&!t.boss.isAlive&&(t.gameState=c.gameFinish),t.axe.calculateShockPoint(),t.isHoldingRefuelKey&&t.refuelStart!=null&&J(),t.isHoldingHealKey&&t.healStart!=null&&J(),be()),(t.gameState==c.menuScreen||t.gameState==c.retryScreen)&&(t.lantern.showLuminosity(),t.ui.renderBloodOverlay(),t.lantern.maxRadiusInnerCircle=10,Q()),t.gameState==c.paused&&(t.lantern.showLuminosity(),t.ui.renderBloodOverlay(),Q()),t.debugCollider&&fe(),Ie(),t.reqAnimFrame=requestAnimationFrame(Et)}t.reqAnimFrame=requestAnimationFrame(Et);
